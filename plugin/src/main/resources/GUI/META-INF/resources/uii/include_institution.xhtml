<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:composite="http://xmlns.jcp.org/jsf/composite"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:x="http://myfaces.apache.org/tomahawk"
    xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
    xmlns:jsf="http://xmlns.jcp.org/jsf"
    xmlns:c="http://java.sun.com/jstl/core"
    xmlns:intranda="http://xmlns.jcp.org/jsf/composite/composites">

    <composite:interface>
    </composite:interface>

    <composite:implementation>
        <h:form
            styleClass="form-horizontal form-bordered"
            id="myform">
            <!-- list of existing institutions -->
            <h:panelGroup
                layout="block"
                styleClass="dataTables_wrapper"
                rendered="#{AdministrationForm.administrationPlugin.editionMode==''}">
                <div class="dataTables_length">
                    <h:outputText value="#{msgs.treffer}: #{AdministrationForm.administrationPlugin.institutionPaginator.totalResults}" />
                </div>

                <x:dataTable
                    styleClass="table table-hover table-nomargin dataTable table-bordered responsive"
                    var="item"
                    value="#{AdministrationForm.administrationPlugin.institutionPaginator.list}">

                    <x:column>
                        <f:facet name="header">
                            <button
                                class="button-link"
                                style="width: 100%; text-align: left;"
                                jsf:action="#{AdministrationForm.administrationPlugin.filterInstitution}">
                                <h:outputText value="#{msgs.institution_shortName}" />
                                <span class="pull-right table-sort-icon fa #{AdministrationForm.administrationPlugin.institutionSort== 'shortName Desc' ?'fa-sort-desc':AdministrationForm.administrationPlugin.institutionSort== 'shortName' ?'fa-sort-asc':'fa-sort'}"></span>
                                <f:setPropertyActionListener
                                    target="#{AdministrationForm.administrationPlugin.institutionSort}"
                                    value="#{AdministrationForm.administrationPlugin.institutionSort== 'shortName' ? 'shortName Desc' : 'shortName' }" />
                                <f:ajax render="@form" />
                            </button>
                        </f:facet>
                        <h:outputText value="#{item.shortName}" />
                    </x:column>

                    <x:column>
                        <f:facet name="header">
                            <button
                                class="button-link"
                                style="width: 100%; text-align: left;"
                                jsf:action="#{AdministrationForm.administrationPlugin.filterInstitution}">
                                <h:outputText value="#{msgs.institution_longName}" />
                                <span class="pull-right table-sort-icon fa #{AdministrationForm.administrationPlugin.institutionSort== 'longName Desc' ?'fa-sort-desc':AdministrationForm.administrationPlugin.institutionSort== 'longName' ?'fa-sort-asc':'fa-sort'}"></span>
                                <f:setPropertyActionListener
                                    target="#{AdministrationForm.administrationPlugin.institutionSort}"
                                    value="#{AdministrationForm.administrationPlugin.institutionSort== 'longName' ? 'longName Desc' : 'longName' }" />
                                <f:ajax render="@form" />
                            </button>
                        </f:facet>
                        <h:outputText value="#{item.longName}" />
                    </x:column>

                    <c:forEach
                        items="#{AdministrationForm.administrationPlugin.configuredInstitutionFields}"
                        var="cif">
                        <x:column
                            style="max-width:250px;"
                            rendered="#{cif.displayInTable}">
                            <f:facet name="header">
                                <button
                                    class="button-link"
                                    style="width: 100%; text-align: left;"
                                    jsf:action="#{AdministrationForm.administrationPlugin.filterInstitution}">
                                    <h:outputText value="#{cif.label}" />
                                    <span class="pull-right table-sort-icon fa #{AdministrationForm.administrationPlugin.institutionSort==(cif.name).concat(' Desc') ?'fa-sort-desc':AdministrationForm.administrationPlugin.institutionSort== cif.name ?'fa-sort-asc':'fa-sort'}"></span>
                                    <f:setPropertyActionListener
                                        target="#{AdministrationForm.administrationPlugin.institutionSort}"
                                        value="#{AdministrationForm.administrationPlugin.institutionSort== cif.name.concat(' Desc') ? cif.name : cif.name.concat(' Desc')}" />
                                    <f:ajax render="@form" />
                                </button>
                            </f:facet>
                            <h:outputText value="#{item.additionalData[cif.name]}" />
                        </x:column>
                    </c:forEach>


                    <x:column width="150px;">
                        <f:facet name="header">
                            <h:outputText value="#{msgs.auswahl}" />
                        </f:facet>
                        <!-- Bearbeiten-Schaltknopf -->
                        <button
                            jsf:id="edit"
                            class="btn margin-right-5"
                            jsf:rel="tooltip"
                            title="#{msgs.institution_edit}">
                            <i class="fa fa-pencil"></i>
                            <f:passThroughAttribute
                                name="data-toggle"
                                value="tooltip" />
                            <f:setPropertyActionListener
                                target="#{AdministrationForm.administrationPlugin.institution}"
                                value="#{item}" />
                            <f:setPropertyActionListener
                                value="edit"
                                target="#{AdministrationForm.administrationPlugin.editionMode}" />
                            <f:ajax render="@form" />
                        </button>
                    </x:column>
                </x:dataTable>

                <div class="dataTables_info">
                    <!-- Neu-Schaltknopf -->
                    <button
                        jsf:id="new"
                        class="btn btn-primary font-size-s"
                        jsf:action="#{AdministrationForm.administrationPlugin.createNewInstitution}"
                        jsf:immediate="true">
                        <i class="fa fa-plus margin-right-5"></i>
                        <h:outputText value="#{msgs.institution_createNew}" />
                        <f:setPropertyActionListener
                            value="edit"
                            target="#{AdministrationForm.administrationPlugin.editionMode}" />
                        <f:ajax render="@form" />
                    </button>
                </div>

                <div class="dataTables_paginate">
                    <intranda:tablePaginator
                        id="inst"
                        paginator="#{AdministrationForm.administrationPlugin.institutionPaginator}" />
                </div>
            </h:panelGroup>

            <h:panelGroup
                layout="block"
                styleClass="dataTables_wrapper"
                rendered="#{AdministrationForm.administrationPlugin.editionMode=='edit'}">
                <div class="tab-content">
                    <intranda:formInputTextAjax
                        id="shortName"
                        label="#{msgs.institution_shortName}"
                        field="#{AdministrationForm.administrationPlugin.institution.shortName}"
                        help="#{msgs.institution_help_shortName}"
                        name="shortName"
                        fieldStyle="form-control"
                        render="@form" />
                    <intranda:formInputTextAjax
                        id="longTitle"
                        name="longTitle"
                        label="#{msgs.institution_longName}"
                        field="#{AdministrationForm.administrationPlugin.institution.longName}"
                        help="#{msgs.institution_help_longName}"
                        fieldStyle="form-control"
                        render="@form" />


                    <!-- additional data -->
                    <ui:repeat
                        var="item"
                        value="#{AdministrationForm.administrationPlugin.configuredInstitutionFields}">

                        <div
                            class="form-group"
                            style="">
                            <div
                                class="col-sm-3 control-label"
                                tabindex="-1">
                                <h:outputLabel
                                    for="id1"
                                    value="#{item.label}" />
                            </div>
                            <div
                                class="col-sm-9"
                                style="">
                                <ui:fragment rendered="#{item.fieldType=='input'}">
                                    <h:inputText
                                        id="input"
                                        styleClass="form-control"
                                        value="#{item.value}"
                                        required="false"
                                        readonly="false">
                                    </h:inputText>
                                </ui:fragment>


                                <ui:fragment rendered="#{item.fieldType=='textarea'}">

                                    <h:inputTextarea
                                        id="textarea"
                                        styleClass="form-control"
                                        value="#{item.value}"
                                        required="false"
                                        readonly="false">
                                    </h:inputTextarea>

                                </ui:fragment>


                                <ui:fragment rendered="#{item.fieldType=='dropdown'}">

                                    <h:selectOneMenu
                                        id="dropdown"
                                        styleClass="form-control"
                                        value="#{item.value}">
                                        <f:selectItem
                                            itemValue="null"
                                            itemLabel="#{msgs.bitteAuswaehlen}" />
                                        <f:selectItems value="#{item.selectItemList}" />
                                    </h:selectOneMenu>
                                </ui:fragment>

                            </div>
                        </div>

                    </ui:repeat>

                </div>


                <div class="form-actions">
                    <!-- Save -->
                    <button
                        class="btn btn-success submitOnEnter pull-right font-size-s margin-bottom-most"
                        jsf:id="absenden"
                        type="submit"
                        jsf:action="#{AdministrationForm.administrationPlugin.saveInstitution}">
                        <i class="fa fa-save margin-right-5"></i>
                        <h:outputText value="#{msgs.speichern}" />
                        <f:setPropertyActionListener
                            value=""
                            target="#{AdministrationForm.administrationPlugin.editionMode}" />
                        <f:ajax
                            render="@form"
                            execute="@form" />
                    </button>

                    <!-- Cancel -->
                    <button
                        class="btn margin-sides-10 font-size-s pull-right"
                        jsf:id="cancel"
                        type="submit"
                        jsf:immediate="true">
                        <h:outputText value="#{msgs.abbrechen}" />
                        <f:setPropertyActionListener
                            value=""
                            target="#{AdministrationForm.administrationPlugin.editionMode}" />
                        <f:ajax render="@form" />
                    </button>
                    <!-- delete -->
                    <ui:fragment rendered="#{AdministrationForm.administrationPlugin.institution.id != null}">
                        <button
                            id="delete"
                            type="button"
                            class="btn btn-danger"
                            data-toggle="modal"
                            data-target="#deleteModal">
                            <i class="fa fa-trash-o margin-right-5" />
                            <h:outputText value="#{msgs.loeschen}" />
                        </button>
                        <div
                            class="modal fade"
                            id="deleteModal"
                            tabindex="-1"
                            role="dialog"
                            aria-labelledby="myModalLabel">
                            <div
                                class="modal-dialog"
                                role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h4
                                            class="modal-title"
                                            id="myModalLabel">
                                            <h:outputText value="#{msgs.loeschen}" />
                                        </h4>
                                    </div>
                                    <div class="modal-body">
                                        <p>#{msgs.sollDieserEintragWirklichGeloeschtWerden}</p>
                                    </div>
                                    <div class="modal-footer">
                                        <button
                                            class="btn"
                                            data-dismiss="modal"
                                            aria-hidden="true">#{msgs.abbrechen}</button>
                                        <button
                                            jsf:id="confirmDelete"
                                            class="btn btn-danger"
                                            jsf:action="#{AdministrationForm.administrationPlugin.deleteInstitution}">
                                            <i class="fa fa-trash-o margin-right-5" />
                                            <f:setPropertyActionListener
                                                value=""
                                                target="#{AdministrationForm.administrationPlugin.editionMode}" />
                                            <h:outputText value="#{msgs.loeschen}" />
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ui:fragment>
                </div>

            </h:panelGroup>

            <!-- edit / new institution -->
        </h:form>
    </composite:implementation>

</ui:composition>