<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:composite="http://xmlns.jcp.org/jsf/composite"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:x="http://myfaces.apache.org/tomahawk"
    xmlns:intranda="http://xmlns.jcp.org/jsf/composite/composites"
    xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
    xmlns:jsf="http://xmlns.jcp.org/jsf"
    xmlns:p="http://primefaces.org/ui">

    <composite:interface>
    </composite:interface>

    <composite:implementation>

        <style>
.grid {
    display: grid;
    grid-template-columns: 15% auto;
    grid-column-gap: 10px;
}

.grid-selection {
    border-right: 1px solid black;
}


#plugin-main-content{
  padding: 1.6rem;
}
   
.col-md-3 {
  padding-top: 16px;
}
   
#plugin-main-content {
  border-left: 2px solid #666;
}

.col-md-3 {
  margin-right: -2px;
  border-right: 2px solid #666;
}

.col-md-3 .btn {
  margin-bottom: 8px;
  background-color: #1F79CC;
  color: #fff;
}

.col-md-3 .btn i {
  margin-left: 8px;
}

.dataTables_wrapper .dataTables_filter {
  margin-right: 0;
}

.dataTables_wrapper .dataTables_info {
    margin-left: 0;
}

</style>
        <script src="template/js/plugins/tinymce/tinymce.min.js"></script>


        <h:panelGroup>
            <div class="row ">
                <div class="col-sm-12">
                    <div class="box box-color box-bordered lightgrey">
                        <div
                            class="box-title"
                            jsf:id="box-title">
                            <h3>
                                <i class="fa fa-plug"></i>
                                <h:outputText value="#{msgs[AdministrationForm.administrationPlugin.title]}" />
                                <h:outputText
                                    value=": #{msgs[AdministrationForm.administrationPlugin.displayMode]}"
                                    rendered="#{AdministrationForm.administrationPlugin.displayMode != null}" />
                            </h3>
                        </div>
                        <div class="box-content nopadding">

                            <h:panelGroup rendered="#{!LoginForm.hasRole('Plugin_administration_deliveryManagement')}">
                                <h:outputText
                                    styleClass="alert alert-danger alert-dismissable margin-bottom-10 margin-top-10"
                                    value="#{msgs.plugin_administration_missingPermission} Plugin_administration_deliveryManagement" />
                            </h:panelGroup>

                            <h:panelGroup
                                id="actionform"
                                rendered="#{LoginForm.hasRole('Plugin_administration_deliveryManagement')}"
                                styleClass="col-sm-12">
                                <div class="row">
                                        <div class="col-md-3">
                                            <h:form styleClass="form-horizontal form-bordered">
                                                <ui:repeat
                                                    var="mode"
                                                    value="#{AdministrationForm.administrationPlugin.modes}">
                                                    <div>
                                                        <button
                                                            type="button"
                                                            class="btn"
                                                            jsf:id="displayDetails">
                                                            <h:outputText value="#{msgs[mode]}" />
                                                            <i class="fa fa-caret-right" aria-hidden="true"></i>
                                                            <f:setPropertyActionListener
                                                                value="#{mode}"
                                                                target="#{AdministrationForm.administrationPlugin.displayMode}" />
                                                            <f:setPropertyActionListener
                                                                value=""
                                                                target="#{AdministrationForm.administrationPlugin.editionMode}" />
                                                            <f:ajax render="@form :box-title :plugin-main-content" />
                                                        </button>
                                                    </div>
                                                </ui:repeat>
                                            </h:form>
                                        </div>
                                        <h:panelGroup
                                            id="plugin-main-content"
                                            layout="block"
                                            styleClass="col-md-9">

                                            <ui:fragment rendered="#{AdministrationForm.administrationPlugin.displayMode == 'displayMode_institution'}">
                                                <ui:include src="include_institution.xhtml" />
                                            </ui:fragment>

                                            <ui:fragment rendered="#{AdministrationForm.administrationPlugin.displayMode == 'displayMode_user'}">
                                                <ui:include src="include_users.xhtml" />
                                            </ui:fragment>

                                            <ui:fragment rendered="#{AdministrationForm.administrationPlugin.displayMode == 'displayMode_privacyPolicy'}">
                                                <ui:include src="include_privacyPolicy.xhtml" />
                                            </ui:fragment>

                                        </h:panelGroup>
                                </div>
                            </h:panelGroup>

                        </div>
                    </div>
                </div>
            </div>
        </h:panelGroup>
<script type="text/javascript">
                                    //<![CDATA[
                                    var simpleTinyMceConfig = {
                                        selector: '.textarea-html',
                                        setup: function( editor ) {
                                            editor.on( 'change', function() {
                                                tinymce.triggerSave();
                                            } );
                                        },
                                        valid_elements: 'p,strong,em,span[!style<text-decoration: underline;],sup,',
                                        statusbar: true,
                                        theme: 'silver',
                                        height: 250,
                                        plugins: [ 'print code preview fullscreen' ],
                                        menu: {},
                                        toolbar: false,
                                        toolbar: 'undo redo | bold italic underline | superscript | code ',
                                        content_css: 'css/content.css',
                                        init_instance_callback: function( editor ) {
                                            var readOnlyAttr = $( "#" + editor.id.replace( ":", "\\:" ) ).attr( "readonly" );
                                            if ( readOnlyAttr === "readonly" ) {
                                                editor.setMode( "readonly" );
                                            }
                                        },
                                        setup: function( editor ) {
                                            editor.on( "blur", function( event, a, b ) {
                                                editor.save();
                                                $( "#" + editor.id.replace( ":", "\\:" ) ).trigger( "change" );
                                            } );
                                        }

                                    };

                                    function initTinyMce() {
                                        console.log( "Init tinyMce" );
                                        tinymce.init( simpleTinyMceConfig );
                                    };

                                    $( window ).on( "load", function() {
                                        renderInputFields()
                                    } );
                                    $( document ).ready(function() {
                                        renderInputFields()
                                    } );

                                    jsf.ajax.addOnEvent( function( data ) {
                                        var ajaxstatus = data.status; // Can be "begin", "complete" and "success"
                                        switch ( ajaxstatus ) {
                                            case "success": // This is called when ajax response is successfully processed.
                                                renderInputFields()
                                                break;
                                        }
                                    } );

                                    function renderInputFields( ajaxData ) {
                                        if ( typeof tinyMCE !== 'undefined' ) {
                                            if ( ajaxData === undefined || ajaxData.status == "begin" ) {
                                                for ( edId in tinyMCE.editors ) {
                                                    try {
                                                        tinyMCE.editors[ edId ].remove();
                                                        console.log( "Removed editor " + edId );
                                                    }
                                                    catch ( error ) {
                                                        console.log( "Error occured during removing editors; ", error );
                                                    }
                                                }
                                            }
                                            if ( ajaxData === undefined || ajaxData.status == "success" ) {
                                                initTinyMce( ajaxData );
                                            }
                                        }
                                    }
                                    //]]>
                                </script>
    </composite:implementation>
</ui:composition>
