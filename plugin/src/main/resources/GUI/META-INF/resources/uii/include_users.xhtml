<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:composite="http://xmlns.jcp.org/jsf/composite"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:x="http://myfaces.apache.org/tomahawk"
    xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
    xmlns:jsf="http://xmlns.jcp.org/jsf"
    xmlns:c="http://java.sun.com/jstl/core"
    xmlns:intranda="http://xmlns.jcp.org/jsf/composite/composites">

    <composite:interface>
    </composite:interface>

    <composite:implementation>
        <h:form styleClass="form-horizontal form-bordered">
            <h:panelGroup
                layout="block"
                styleClass="dataTables_wrapper col-md-12"
                rendered="#{AdministrationForm.administrationPlugin.editionMode==''}">
                <div class="dataTables_length">
                    <h:outputText value="#{msgs.treffer}: #{AdministrationForm.administrationPlugin.userPaginator.totalResults}" />
                </div>

                <div class="dataTables_filter">
                    <div class="input-group input-group">
                        <span class="input-group-addon">
                            <i class="fa fa-search"></i>
                        </span>
                        <h:inputText
                            id="searchfield"
                            styleClass="form-control searchfield"
                            value="#{AdministrationForm.administrationPlugin.userSearchFilter}">
                            <f:passThroughAttribute
                                name="placeholder"
                                value="#{msgs.benutzer}" />
                            <f:passThroughAttribute
                                name="aria-label"
                                value="#{msgs.benutzer}" />
                        </h:inputText>
                        <div class="input-group-btn">
                            <button
                                jsf:id="FilterAlle2"
                                jsf:forceId="true"
                                class="btn"
                                style="text-align: center; line-height: 100%; padding: 0px 10px"
                                jsf:action="#{AdministrationForm.administrationPlugin.filterUser}">#{msgs.search}</button>
                        </div>
                    </div>
                    <x:commandButton
                        type="submit"
                        id="FilterAlle"
                        forceId="true"
                        style="display:none"
                        action="#{AdministrationForm.administrationPlugin.filterUser}" />
                </div>
                <!-- checkbox to show inactive users only -->
                <div class="dataTables_filter">
                    <button
                        jsf:id="excludeActiveUsers"
                        class="btn searchfieldbuttongroup hidden-xs"
                        jsf:action="#{AdministrationForm.administrationPlugin.filterUser}"
                        jsf:immediate="true">
                        <i class="fa #{AdministrationForm.administrationPlugin.showOnlyInactiveUser?'fa-check-square-o':'fa-square-o'} margin-right-5"></i>
                        <h:outputText
                            styleClass="font-size-s"
                            value="#{msgs.plugin_administration_deliveryManagement_showOnlyInactiveUser}" />
                        <f:setPropertyActionListener
                            target="#{AdministrationForm.administrationPlugin.showOnlyInactiveUser}"
                            value="#{not AdministrationForm.administrationPlugin.showOnlyInactiveUser}" />
                    </button>
                </div>

                <table
                    role="grid"
                    id="tableUserAll"
                    class="table table-hover table-nomargin dataTable table-bordered responsive">
                    <!-- ### Columnheader row ### -->
                    <thead>
                        <tr role="row">
                            <th
                                scope="col"
                                role="columnheader">
                                <button
                                    class="button-link"
                                    style="width: 100%; text-align: left;"
                                    jsf:action="#{AdministrationForm.administrationPlugin.filterUser}">
                                    <h:outputText value="#{msgs.benutzer}" />
                                    <span class="pull-right table-sort-icon fa #{AdministrationForm.administrationPlugin.userSort== 'benutzer.Nachname Desc, benutzer.Vorname Desc' ?'fa-sort-desc':AdministrationForm.administrationPlugin.userSort== 'benutzer.Nachname, benutzer.Vorname' ?'fa-sort-asc':'fa-sort'}"></span>
                                    <f:setPropertyActionListener
                                        target="#{AdministrationForm.administrationPlugin.userSort}"
                                        value="#{AdministrationForm.administrationPlugin.userSort== 'benutzer.Nachname, benutzer.Vorname' ? 'benutzer.Nachname Desc, benutzer.Vorname Desc' : 'benutzer.Nachname, benutzer.Vorname' }" />
                                    <f:ajax render="@form" />
                                </button>
                            </th>

                            <th
                                scope="col"
                                role="columnheader">
                                <button
                                    class="button-link"
                                    style="width: 100%; text-align: left;"
                                    jsf:action="#{AdministrationForm.administrationPlugin.filterUser}">
                                    <h:outputText value="#{msgs.login}" />
                                    <span class="pull-right table-sort-icon fa #{AdministrationForm.administrationPlugin.userSort== 'benutzer.login Desc' ?'fa-sort-desc':AdministrationForm.administrationPlugin.userSort== 'benutzer.login' ?'fa-sort-asc':'fa-sort'}"></span>
                                    <f:setPropertyActionListener
                                        target="#{AdministrationForm.administrationPlugin.userSort}"
                                        value="#{AdministrationForm.administrationPlugin.userSort== 'benutzer.login' ? 'benutzer.login Desc' : 'benutzer.login' }" />
                                    <f:ajax render="@form" />
                                </button>
                            </th>

                            <th
                                scope="col"
                                role="columnheader">
                                <button
                                    class="button-link"
                                    style="width: 100%; text-align: left;"
                                    jsf:action="#{AdministrationForm.administrationPlugin.filterUser}">
                                    <h:outputText value="#{msgs.email}" />
                                    <span class="pull-right table-sort-icon fa #{AdministrationForm.administrationPlugin.userSort== 'benutzer.email Desc' ?'fa-sort-desc':AdministrationForm.administrationPlugin.userSort== 'benutzer.email' ?'fa-sort-asc':'fa-sort'}"></span>
                                    <f:setPropertyActionListener
                                        target="#{AdministrationForm.administrationPlugin.userSort}"
                                        value="#{AdministrationForm.administrationPlugin.userSort== 'benutzer.email' ? 'benutzer.email Desc' : 'benutzer.email' }" />
                                    <f:ajax render="@form" />
                                </button>
                            </th>


                            <th
                                scope="col"
                                role="columnheader">
                                <button
                                    class="button-link"
                                    style="width: 100%; text-align: left;"
                                    jsf:action="#{AdministrationForm.administrationPlugin.filterUser}">
                                    <h:outputText value="#{msgs.institution}" />
                                    <span class="pull-right table-sort-icon fa #{AdministrationForm.administrationPlugin.userSort== 'institution.shortName Desc' ?'fa-sort-desc':AdministrationForm.administrationPlugin.userSort== 'institution.shortName' ?'fa-sort-asc':'fa-sort'}"></span>
                                    <f:setPropertyActionListener
                                        target="#{AdministrationForm.administrationPlugin.userSort}"
                                        value="#{AdministrationForm.administrationPlugin.userSort== 'institution.shortName Desc' ? 'institution.shortName' : 'institution.shortName Desc' }" />
                                    <f:ajax render="@form" />
                                </button>
                            </th>



                            <!-- additional fields -->
                            <c:forEach
                                items="#{AdministrationForm.administrationPlugin.configuredUserFields}"
                                var="cif">
                                <ui:fragment rendered="#{cif.displayInTable}">

                                    <th
                                        scope="col"
                                        role="columnheader">
                                        <button
                                            class="button-link"
                                            style="width: 100%; text-align: left;"
                                            jsf:action="#{AdministrationForm.administrationPlugin.filterUser}">
                                            <h:outputText value="#{cif.label}" />
                                            <span class="pull-right table-sort-icon fa #{AdministrationForm.administrationPlugin.userSort==(cif.name).concat(' Desc') ?'fa-sort-desc':AdministrationForm.administrationPlugin.userSort== cif.name ?'fa-sort-asc':'fa-sort'}"></span>
                                            <f:setPropertyActionListener
                                                target="#{AdministrationForm.administrationPlugin.userSort}"
                                                value="#{AdministrationForm.administrationPlugin.userSort== cif.name.concat(' Desc') ? cif.name : cif.name.concat(' Desc') }" />
                                            <f:ajax render="@form" />
                                        </button>
                                    </th>




                                </ui:fragment>
                            </c:forEach>

                            <intranda:columnheader
                                value="#{msgs.auswahl}"
                                sortable="false" />
                        </tr>
                    </thead>
                    <!-- ### Content rows ### -->
                    <ui:repeat
                        var="item"
                        value="#{AdministrationForm.administrationPlugin.userPaginator.list}"
                        varStatus="status">
                        <tr role="row">
                            <td>
                                <h:outputText
                                    value="#{item.nachname}, #{item.vorname}"
                                    styleClass="userID_#{item.vorname}_#{item.nachname} #{not item.active?'font-light':''}"
                                    title="#{item.login}" />
                            </td>
                            <td>
                                <h:outputText
                                    value="#{item.login}"
                                    styleClass="#{not item.active?'font-light':''}" />
                            </td>
                            <td>
                                <h:outputText
                                    value="#{item.email}"
                                    styleClass="#{not item.active?'font-light':''}" />
                            </td>
                            <td>
                                <h:outputText
                                    value="#{item.institution.shortName}"
                                    styleClass="#{not item.active?'font-light':''}" />
                            </td>

                            <!-- additional fields -->
                            <c:forEach
                                items="#{AdministrationForm.administrationPlugin.configuredUserFields}"
                                var="cif">
                                <ui:fragment rendered="#{cif.displayInTable}">
                                    <td>
                                        <h:outputText value="#{item.additionalData[cif.name]}" />
                                    </td>
                                </ui:fragment>
                            </c:forEach>

                            <td>
                                <div class="no-linebreak">
                                    <!-- Bearbeiten-Schaltknopf -->
                                    <button
                                        jsf:id="edit"
                                        class="btn margin-right-5"
                                        jsf:rel="tooltip"
                                        title="#{msgs.benutzerBearbeiten}">
                                        <i class="fa fa-pencil"></i>
                                        <f:passThroughAttribute
                                            name="data-toggle"
                                            value="tooltip" />
                                        <f:passThroughAttribute
                                            name="aria-label"
                                            value="#{msgs.benutzerBearbeiten}" />
                                        <f:setPropertyActionListener
                                            target="#{AdministrationForm.administrationPlugin.user}"
                                            value="#{item}" />
                                        <f:setPropertyActionListener
                                            value="edit"
                                            target="#{AdministrationForm.administrationPlugin.editionMode}" />
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </ui:repeat>
                </table>

                <div class="dataTables_info">
                    <button
                        jsf:id="newUser"
                        class="btn btn-primary font-size-s"
                        jsf:action="#{AdministrationForm.administrationPlugin.createNewUser}"
                        jsf:immediate="true">
                        <i class="fa fa-plus margin-right-5"></i>
                        <h:outputText value="#{msgs.neuenBenutzerAnlegen}" />
                        <f:setPropertyActionListener
                            value="edit"
                            target="#{AdministrationForm.administrationPlugin.editionMode}" />
                    </button>
                <div class="dataTables_paginate">
                    <intranda:tablePaginator2
                        id="user"
                        name="users"
                        paginator="#{AdministrationForm.administrationPlugin.userPaginator}" />
                </div>
                </div>
            </h:panelGroup>

            <h:panelGroup
                layout="block"
                styleClass="dataTables_wrapper edit-mode"
                rendered="#{AdministrationForm.administrationPlugin.editionMode=='edit'}">
                <div class="tab-content">
                    <intranda:formInputText
                        classLeft="col-sm-3 control-label notFocusable"
                        id="lastname"
                        label="#{msgs.nachname}"
                        field="#{AdministrationForm.administrationPlugin.user.nachname}"
                        help="#{msgs.helpNachname}"
                        name="nachname"
                        fieldStyle="form-control" />

                    <intranda:formInputText
                        classLeft="col-sm-3 control-label notFocusable"
                        id="firstname"
                        label="#{msgs.vorname}"
                        field="#{AdministrationForm.administrationPlugin.user.vorname}"
                        help="#{msgs.helpVorname}"
                        name="vorname"
                        fieldStyle="form-control" />

                    <intranda:formInputText
                        classLeft="col-sm-3 control-label notFocusable"
                        id="location"
                        label="#{msgs.standort}"
                        field="#{AdministrationForm.administrationPlugin.user.standort}"
                        help="#{msgs.helpStandort}"
                        name="standort"
                        fieldStyle="form-control" />


                        <div class="form-group">
                            <div class="col-sm-3 control-label notFocusable control-label">
                                <h:outputLabel for="institution" value="#{msgs.institution}" />
                                <i class="fa fa-asterisk font-asterisk font-asterisk-absolute" title="#{msgs.requiredField}" data-toggle="tooltip"/>

                            <!-- open institution -->
                            <button
                                class="btn margin-right-5 pull-right btn--in-label"
                                jsf:rel="tooltip"
                                aria-label="#{msgs.plugin_administration_deliveryManagement_openInsititution}"
                                jsf:title="#{msgs.plugin_administration_deliveryManagement_openInsititution}"
                                jsf:action="#{AdministrationForm.administrationPlugin.openInstitution}">
                                <i class="fa fa-search"></i>
                                <f:passThroughAttribute
                                    name="data-toggle"
                                    value="tooltip" />
                            </button>

                            </div>
                            <div class="col-sm-9">
                                <h:selectOneMenu id="institution" styleClass="form-control"
                                    value="#{AdministrationForm.administrationPlugin.currentInstitutionID}"  readonly="false">
                                    <f:selectItem itemValue="null" itemLabel="#{msgs.bitteAuswaehlen}" />
                                    <f:selectItems value="#{BenutzerverwaltungForm.institutionsAsSelectList}" />
                                </h:selectOneMenu>
                                <h:message for="institution" showDetail="true" styleClass="help-inline font-danger"/>
                                <intranda:formHelp content="#{msgs.helpUserInstitution}" />
                            </div>
                        </div>


                    <div class="form-group">
                        <div class="col-sm-3 control-label">
                            <h:outputLabel
                                for="loginAs"
                                value="#{msgs.login}">
                                <i
                                    class="fa fa-asterisk pull-right font-asterisk"
                                    title="#{msgs.requiredField}"
                                    data-toggle="tooltip" />
                            </h:outputLabel>
                        </div>
                        <div class="col-sm-9">
                            <x:inputText
                                id="loginAs"
                                forceId="true"
                                styleClass="form-control"
                                value="#{AdministrationForm.administrationPlugin.user.login}"
                                required="true"
                                readonly="false"
                                validatorMessage="#{msgs.loginWrongCharacter}">
                                <f:validateRegex pattern="[a-z0-9\._-]+" />
                            </x:inputText>
                            <h:message
                                for="loginAs"
                                showDetail="true"
                                styleClass="help-inline font-danger" />
                            <intranda:formHelp content="#{msgs.helpLogin}" />
                        </div>
                    </div>

                    <!-- email -->
                    <intranda:formInputText
                        classLeft="col-sm-3 control-label notFocusable"
                        id="email"
                        label="#{msgs.email}"
                        field="#{AdministrationForm.administrationPlugin.user.email}"
                        help="#{msgs.helpEmail}"
                        required="false"
                        name="emailName"
                        fieldStyle="form-control" />


                    <!-- authentication type -->
                    <div class="form-group">
                        <div class="col-sm-3 control-label">
                            <h:outputLabel
                                for="ldapGruppe"
                                value="#{msgs.user_edit_loginType}">
                                <i
                                    class="fa fa-asterisk pull-right font-asterisk"
                                    title="#{msgs.requiredField}"
                                    data-toggle="tooltip" />
                            </h:outputLabel>
                        </div>
                        <div class="col-sm-9">
                            <h:selectOneMenu
                                id="ldapGruppe"
                                styleClass="form-control"
                                value="#{AdministrationForm.administrationPlugin.authenticationType}">
                                <f:selectItems
                                    value="#{BenutzerverwaltungForm.ldapGruppeAuswahlListe}"
                                    var="var"
                                    itemLabel="#{var.itemLabel}"
                                    itemValue="#{var.itemValue}" />
                            </h:selectOneMenu>
                            <h:message
                                for="ldapGruppe"
                                showDetail="true"
                                styleClass="help-inline font-danger" />
                            <intranda:formHelp content="#{msgs.helpLdapGruppe}" />
                        </div>
                    </div>


                    <intranda:formInputCheckBox
                        classLeft="col-sm-3 control-label notFocusable"
                        id="isActive"
                        label="#{msgs.istAktiv}"
                        field="#{AdministrationForm.administrationPlugin.userIsActive}"
                        help="#{msgs.helpIstAktiv}"
                        name="istAktiv" />

                    <intranda:formInputDropDown
                        classLeft="col-sm-3 control-label notFocusable"
                        id="dashboard"
                        label="#{msgs.dashboard}"
                        field="#{AdministrationForm.administrationPlugin.user.dashboardPlugin}"
                        help="#{msgs.helpUserDashboard}"
                        name="dashboardName"
                        selectItems="#{AdministrationForm.administrationPlugin.user.availableDashboards}"
                        fieldStyle="form-control" />


                    <!-- additional data -->
                    <ui:repeat
                        var="item"
                        varStatus="status"
                        value="#{AdministrationForm.administrationPlugin.configuredUserFields}">
                        <ui:fragment rendered="#{item.fieldType=='input'}">
                            <intranda:formInputText
                                name="#{status.index}field"
                                label="#{msgs[item.label]}"
                                field="#{item.value}"
                                help="#{item.helpMessage}"
                                fieldStyle="form-control"
                                required="#{item.required}" />
                        </ui:fragment>
                        <ui:fragment rendered="#{item.fieldType=='textarea'}">
                            <intranda:formInputTextArea
                                name="#{status.index}field"
                                label="#{msgs[item.label]}"
                                field="#{item.value}"
                                help="#{item.helpMessage}"
                                fieldStyle="form-control"
                                required="#{item.required}" />
                        </ui:fragment>
                        <ui:fragment rendered="#{item.fieldType=='dropdown'}">
                            <intranda:formInputDropDown2
                                label="#{msgs[item.label]}"
                                field="#{item.value}"
                                help="#{item.helpMessage}"
                                name="#{status.index}field"
                                selectItems="#{item.selectItemList}"
                                fieldStyle="form-control"
                                required="#{item.required}"
                                itemValue="#{var}"
                                itemLabel="#{msgs[var]}" />
                        </ui:fragment>


                        <ui:fragment rendered="#{item.fieldType=='combo'}">
                            <div
                                class="form-group"
                                style="">
                                <div
                                    class="col-sm-3 control-label"
                                    tabindex="-1">
                                    <h:outputLabel
                                        for="id"
                                        value="#{msgs[item.label]}" />
                                </div>
                                <div
                                    class="col-sm-9"
                                    style="">
                                    <h:panelGroup
                                        id="combo"
                                        rendered="#{item.fieldType=='combo'}">
                                        <h:selectBooleanCheckbox
                                            id="combo1"
                                            styleClass="form-control"
                                            value="#{item.booleanValue}">
                                            <f:ajax
                                                render="@form"
                                                execute="@this" />
                                        </h:selectBooleanCheckbox>
                                        <h:selectOneRadio
                                            rendered="#{item.booleanValue}"
                                            id="combo2"
                                            styleClass="form-control"
                                            value="#{item.subValue}">

                                            <f:selectItems value="#{item.selectItemList}" itemLabel="#{msgs[val]}" itemValue="#{val}" var="val" />
                                        </h:selectOneRadio>
                                    </h:panelGroup>
                                    <intranda:formHelp content="#{item.helpMessage}" />
                                </div>

                            </div>
                        </ui:fragment>
                    </ui:repeat>


                </div>


                <div class="form-actions">
                    <!-- Save -->
                    <button
                        class="btn btn-success submitOnEnter pull-right font-size-s margin-bottom-most"
                        jsf:id="absenden"
                        type="submit"
                        jsf:action="#{AdministrationForm.administrationPlugin.saveUser}">
                        <i class="fa fa-save margin-right-5"></i>
                        <h:outputText value="#{msgs.speichern}" />
                        <f:setPropertyActionListener
                            value=""
                            target="#{AdministrationForm.administrationPlugin.editionMode}" />
                        <f:ajax
                            render="@all"
                            execute="@form" />
                    </button>

                    <!-- Cancel -->
                    <button
                        class="btn margin-sides-10 font-size-s pull-right"
                        jsf:id="cancel"
                        type="submit"
                        jsf:immediate="true">
                        <h:outputText value="#{msgs.abbrechen}" />
                        <f:setPropertyActionListener
                            value=""
                            target="#{AdministrationForm.administrationPlugin.editionMode}" />
                        <f:ajax render="@all" />
                    </button>
                    <!-- delete -->
                    <ui:fragment rendered="#{AdministrationForm.administrationPlugin.user.id != null}">
                        <button
                            id="delete"
                            type="button"
                            class="btn btn-danger"
                            data-toggle="modal"
                            data-target="#deleteModal">
                            <i class="fa fa-trash-o margin-right-5" />
                            <h:outputText value="#{msgs.loeschen}" />
                        </button>
                        <div
                            class="modal fade"
                            id="deleteModal"
                            tabindex="-1"
                            role="dialog"
                            aria-labelledby="myModalLabel">
                            <div
                                class="modal-dialog"
                                role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h4
                                            class="modal-title"
                                            id="myModalLabel">
                                            <h:outputText value="#{msgs.loeschen}" />
                                        </h4>
                                    </div>
                                    <div class="modal-body">
                                        <p>#{msgs.sollDieserEintragWirklichGeloeschtWerden}</p>
                                    </div>
                                    <div class="modal-footer">
                                        <button
                                            class="btn"
                                            data-dismiss="modal"
                                            aria-hidden="true">#{msgs.abbrechen}</button>
                                        <button
                                            jsf:id="confirmDelete"
                                            class="btn btn-danger"
                                            jsf:action="#{AdministrationForm.administrationPlugin.deleteUser}">
                                            <i class="fa fa-trash-o margin-right-5" />
                                            <f:setPropertyActionListener
                                                value=""
                                                target="#{AdministrationForm.administrationPlugin.editionMode}" />
                                            <h:outputText value="#{msgs.loeschen}" />
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ui:fragment>
                </div>

            </h:panelGroup>
        </h:form>
    </composite:implementation>

</ui:composition>
