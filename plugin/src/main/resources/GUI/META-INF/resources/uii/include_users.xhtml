<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:composite="http://xmlns.jcp.org/jsf/composite"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:x="http://myfaces.apache.org/tomahawk"
    xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
    xmlns:jsf="http://xmlns.jcp.org/jsf"
    xmlns:c="http://java.sun.com/jstl/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:intranda="http://xmlns.jcp.org/jsf/composite/composites">

    <composite:interface>
    </composite:interface>

    <composite:implementation>

        <h:form styleClass="form-horizontal form-bordered">
            <h:panelGroup
                layout="block"
                styleClass="dataTables_wrapper col-md-12"
                rendered="#{AdministrationForm.administrationPlugin.editionMode==''}">
                <div class="dataTables_length">
                    <h:outputText value="#{msgs.treffer}: #{AdministrationForm.administrationPlugin.userPaginator.totalResults}" />
                </div>

                <div class="dataTables_filter">
                    <div class="input-group input-group">
                        <span class="input-group-addon">
                            <span class="fa fa-search" />
                        </span>
                        <h:inputText
                            id="searchfield"
                            styleClass="form-control searchfield"
                            value="#{AdministrationForm.administrationPlugin.userSearchFilter}">
                            <f:passThroughAttribute
                                name="placeholder"
                                value="#{msgs.benutzer}" />
                            <f:passThroughAttribute
                                name="aria-label"
                                value="#{msgs.benutzer}" />
                        </h:inputText>
                        <div class="input-group-btn">
                            <button
                                jsf:id="FilterAlle2"
                                jsf:forceId="true"
                                class="btn"
                                style="text-align: center; line-height: 100%; padding: 0px 10px"
                                jsf:action="#{AdministrationForm.administrationPlugin.filterUser}">#{msgs.search}</button>
                        </div>
                    </div>
                    <x:commandButton
                        type="submit"
                        id="FilterAlle"
                        forceId="true"
                        style="display:none"
                        action="#{AdministrationForm.administrationPlugin.filterUser}" />
                </div>
                <!-- checkbox to show all users -->
                <div class="dataTables_filter">
                    <button
                        jsf:id="excludeActiveUsers"
                        class="btn searchfieldbuttongroup hidden-xs"
                        jsf:action="#{AdministrationForm.administrationPlugin.filterUser}"
                        jsf:immediate="true">
                        <span class="fa #{AdministrationForm.administrationPlugin.showOnlyInactiveUser?'fa-square-o':'fa-check-square-o'} margin-right-5" />
                        <h:outputText
                            styleClass="font-size-s"
                            value="#{msgs.plugin_administration_deliveryManagement_showAllUsers}" />
                        <f:setPropertyActionListener
                            target="#{AdministrationForm.administrationPlugin.showOnlyInactiveUser}"
                            value="#{not AdministrationForm.administrationPlugin.showOnlyInactiveUser}" />
                    </button>
                </div>

                <x:dataTable
                    styleClass="table table-hover table-nomargin dataTable table-bordered responsive"
                    var="item"
                    value="#{AdministrationForm.administrationPlugin.userPaginator.list}">

                    <!-- NAME -->
                    <x:column>
                        <f:facet name="header">
                            <button
                                class="button-link"
                                style="width: 100%; text-align: left;"
                                jsf:action="#{AdministrationForm.administrationPlugin.filterUser}">
                                <h:outputText value="#{msgs.plugin_administration_deliveryManagement_name}" />
                                <span class="pull-right table-sort-icon fa #{AdministrationForm.administrationPlugin.userSort== 'benutzer.Nachname Desc, benutzer.Vorname Desc' ?'fa-sort-desc':AdministrationForm.administrationPlugin.userSort== 'benutzer.Nachname, benutzer.Vorname' ?'fa-sort-asc':'fa-sort'}"></span>
                                <f:setPropertyActionListener
                                    target="#{AdministrationForm.administrationPlugin.userSort}"
                                    value="#{AdministrationForm.administrationPlugin.userSort== 'benutzer.Nachname, benutzer.Vorname' ? 'benutzer.Nachname Desc, benutzer.Vorname Desc' : 'benutzer.Nachname, benutzer.Vorname' }" />
                                <f:ajax render="@form" />
                            </button>
                        </f:facet>
                        <h:outputText
                            value="#{item.user.nachname}, #{item.user.vorname}"
                            styleClass="userID_#{item.user.vorname}_#{item.user.nachname}"
                            title="#{item.user.login}" />
                    </x:column>

                    <!-- LOGIN -->
                    <x:column>
                        <f:facet name="header">
                            <button
                                class="button-link"
                                style="width: 100%; text-align: left;"
                                jsf:action="#{AdministrationForm.administrationPlugin.filterUser}">
                                <h:outputText value="#{msgs.login}" />
                                <span class="pull-right table-sort-icon fa #{AdministrationForm.administrationPlugin.userSort== 'benutzer.login Desc' ?'fa-sort-desc':AdministrationForm.administrationPlugin.userSort== 'benutzer.login' ?'fa-sort-asc':'fa-sort'}"></span>
                                <f:setPropertyActionListener
                                    target="#{AdministrationForm.administrationPlugin.userSort}"
                                    value="#{AdministrationForm.administrationPlugin.userSort== 'benutzer.login' ? 'benutzer.login Desc' : 'benutzer.login' }" />
                                <f:ajax render="@form" />
                            </button>
                        </f:facet>
                        <h:outputText value="#{item.user.login}" />
                    </x:column>

                    <!-- EMAIL -->
                    <x:column>
                        <f:facet name="header">
                            <button
                                class="button-link"
                                style="width: 100%; text-align: left;"
                                jsf:action="#{AdministrationForm.administrationPlugin.filterUser}">
                                <h:outputText value="#{msgs.email}" />
                                <span class="pull-right table-sort-icon fa #{AdministrationForm.administrationPlugin.userSort== 'benutzer.email Desc' ?'fa-sort-desc':AdministrationForm.administrationPlugin.userSort== 'benutzer.email' ?'fa-sort-asc':'fa-sort'}"></span>
                                <f:setPropertyActionListener
                                    target="#{AdministrationForm.administrationPlugin.userSort}"
                                    value="#{AdministrationForm.administrationPlugin.userSort== 'benutzer.email' ? 'benutzer.email Desc' : 'benutzer.email' }" />
                                <f:ajax render="@form" />
                            </button>
                        </f:facet>
                        <h:outputText value="#{item.user.email}" />
                    </x:column>

                    <!-- INSTITUTION -->
                    <x:column>
                        <f:facet name="header">
                            <button
                                class="button-link"
                                style="width: 100%; text-align: left;"
                                jsf:action="#{AdministrationForm.administrationPlugin.filterUser}">
                                <h:outputText value="#{msgs.plugin_administration_deliveryManagement_intitution}" />
                                <span class="pull-right table-sort-icon fa #{AdministrationForm.administrationPlugin.userSort== 'institution.longName Desc' ?'fa-sort-desc':AdministrationForm.administrationPlugin.userSort== 'institution.longName' ?'fa-sort-asc':'fa-sort'}"></span>
                                <f:setPropertyActionListener
                                    target="#{AdministrationForm.administrationPlugin.userSort}"
                                    value="#{AdministrationForm.administrationPlugin.userSort== 'institution.longName' ? 'institution.longName Desc' : 'institution.longName' }" />
                                <f:ajax render="@form" />
                            </button>
                        </f:facet>
                        <h:outputText value="#{item.institution.longName}" />
                    </x:column>

                    <!-- LAST CHANGE -->
                    <x:column>
                        <f:facet name="header">
                            <button
                                class="button-link"
                                style="width: 100%; text-align: left;"
                                jsf:action="#{AdministrationForm.administrationPlugin.filterUser}">
                                <h:outputText value="#{msgs.plugin_administration_deliveryManagement_lastChangeDate}" />
                                <span class="pull-right table-sort-icon fa #{AdministrationForm.administrationPlugin.userSort== 'lastDate Desc' ?'fa-sort-desc':AdministrationForm.administrationPlugin.userSort== 'lastDate' ?'fa-sort-asc':'fa-sort'}"></span>
                                <f:setPropertyActionListener
                                    target="#{AdministrationForm.administrationPlugin.userSort}"
                                    value="#{AdministrationForm.administrationPlugin.userSort== 'lastDate' ? 'lastDate Desc' : 'lastDate' }" />
                                <f:ajax render="@form" />
                            </button>
                        </f:facet>
                        <h:outputText value="#{item.lastUploadDate == null ? ' - ' : item.lastUploadDate}">
                            <f:convertDateTime
                                type="both"
                                dateStyle="short"
                                timeStyle="medium" />
                        </h:outputText>
                    </x:column>

                    <!-- NUMBER OF UPLOADS -->
                    <x:column>
                        <f:facet name="header">
                            <button
                                class="button-link"
                                style="width: 100%; text-align: left;"
                                jsf:action="#{AdministrationForm.administrationPlugin.filterUser}">
                                <h:outputText value="#{msgs.plugin_administration_deliveryManagement_numberOfUploads}" />
                                <span class="pull-right table-sort-icon fa #{AdministrationForm.administrationPlugin.userSort== 'items Desc' ?'fa-sort-desc':AdministrationForm.administrationPlugin.userSort== 'items' ?'fa-sort-asc':'fa-sort'}"></span>
                                <f:setPropertyActionListener
                                    target="#{AdministrationForm.administrationPlugin.userSort}"
                                    value="#{AdministrationForm.administrationPlugin.userSort== 'items' ? 'items Desc' : 'items' }" />
                                <f:ajax render="@form" />
                            </button>
                        </f:facet>
                        <h:outputText value="#{item.numberOfUploads gt 0 ? item.numberOfUploads : '-'}" />
                    </x:column>

                    <!-- ACCOUNT STATUS -->
                    <x:column>
                        <f:facet name="header">
                            <button
                                class="button-link"
                                style="width: 100%; text-align: left;"
                                jsf:action="#{AdministrationForm.administrationPlugin.filterUser}">
                                <h:outputText value="#{msgs.plugin_administration_deliveryManagement_status}" />
                                <span class="pull-right table-sort-icon fa #{AdministrationForm.administrationPlugin.userSort== 'status Desc' ?'fa-sort-desc':AdministrationForm.administrationPlugin.userSort== 'status' ?'fa-sort-asc':'fa-sort'}"></span>
                                <f:setPropertyActionListener
                                    target="#{AdministrationForm.administrationPlugin.userSort}"
                                    value="#{AdministrationForm.administrationPlugin.userSort== 'status' ? 'status Desc' : 'status' }" />
                                <f:ajax render="@form" />
                            </button>
                        </f:facet>

                        <h:panelGroup
                            rendered="#{item.user.status eq 'REGISTERED'}"
                            class="badge badge-intranda-orange">
                            <i class="fa fa-key"></i> #{msgs.plugin_administration_deliveryManagement_displayMode_user_status_registered}
						</h:panelGroup>
                        <h:panelGroup
                            rendered="#{item.user.status eq 'ACTIVE'}"
                            class="badge badge-intranda-green">
                            <i class="fa fa-unlock"></i> #{msgs.plugin_administration_deliveryManagement_displayMode_user_status_active}
						</h:panelGroup>
                        <h:panelGroup
                            rendered="#{item.user.status eq 'INACTIVE'}"
                            class="badge badge-intranda-grey">
                            <i class="fa fa-lock"></i> #{msgs.plugin_administration_deliveryManagement_displayMode_user_status_inactive}
						</h:panelGroup>
                        <h:panelGroup
                            rendered="#{item.user.status eq 'REJECTED'}"
                            class="badge badge-intranda-red">
                            <i class="fa fa-lock"></i> ##{msgs.plugin_administration_deliveryManagement_displayMode_user_status_rejected}
						</h:panelGroup>
                        <h:panelGroup
                            rendered="#{item.user.status eq 'DELETED'}"
                            class="badge badge-intranda-red">
                            <i class="fa fa-lock"></i> #{msgs.plugin_administration_deliveryManagement_displayMode_user_status_deleted}
						</h:panelGroup>

                    </x:column>

                    <!-- ACTION -->
                    <x:column width="150px;">
                        <f:facet name="header">
                            <h:outputText value="#{msgs.auswahl}" />
                        </f:facet>

                        <!-- EDIT -->
                        <button
                            jsf:id="edit"
                            class="btn margin-right-5"
                            jsf:rel="tooltip"
                            title="#{msgs.benutzerBearbeiten}">
                            <span class="fa fa-pencil" />
                            <f:passThroughAttribute
                                name="data-toggle"
                                value="tooltip" />
                            <f:passThroughAttribute
                                name="aria-label"
                                value="#{msgs.benutzerBearbeiten}" />
                            <f:setPropertyActionListener
                                target="#{AdministrationForm.administrationPlugin.currentUser}"
                                value="#{item}" />
                            <f:setPropertyActionListener
                                value="edit"
                                target="#{AdministrationForm.administrationPlugin.editionMode}" />
                        </button>

                        <!-- DOWNLOAD INSTITUTION DATA -->
                        <button
                            jsf:id="export"
                            class="btn margin-right-5"
                            jsf:rel="tooltip"
                            aria-label="#{msgs.plugin_administration_deliveryManagement_downloadInstitutionData}"
                            title="#{msgs.plugin_administration_deliveryManagement_downloadInstitutionData}"
                            jsf:action="#{AdministrationForm.administrationPlugin.exportInstitutionCoreData}">
                            <span class="fa fa-download" />
                            <f:passThroughAttribute
                                name="data-toggle"
                                value="tooltip" />
                            <f:setPropertyActionListener
                                target="#{AdministrationForm.administrationPlugin.institution}"
                                value="#{item.institution}" />
                        </button>

                        <!-- DISPLAY IMPORTS -->
                        <button
                            jsf:rendered="#{item.numberOfUploads gt 0}"
                            class="btn margin-right-5"
                            jsf:rel="tooltip"
                            aria-label="#{msgs.plugin_administration_deliveryManagement_displayImports}"
                            jsf:title="#{msgs.plugin_administration_deliveryManagement_displayImports}"
                            jsf:action="#{AdministrationForm.administrationPlugin.generateInstitutionProcessTitleList}">
                            <span class="fa fa-list" />
                            <f:passThroughAttribute
                                name="data-toggle"
                                value="tooltip" />
                            <f:setPropertyActionListener
                                target="#{AdministrationForm.administrationPlugin.institution}"
                                value="#{item.institution}" />
                            <f:setPropertyActionListener
                                value="imports"
                                target="#{AdministrationForm.administrationPlugin.editionMode}" />
                            <f:ajax render="@all" />
                        </button>
                    </x:column>
                </x:dataTable>


                <!-- BUTTON ROW -->
                <div class="dataTables_info">

                    <!-- UPLOAD -->
                    <p:fileUpload
                        listener="#{AdministrationForm.administrationPlugin.handleFileUpload}"
                        id="upload"
                        name="uploadName"
                        auto="true"
                        style="font-weight:normal"
                        mode="advanced"
                        multiple="true"
                        dragDropSupport="true"
                        label="#{msgs.plugin_administration_deliveryManagement_uploadInstitutionData}"
                        allowTypes="/(\.|\/)(xml)$/"
                        update="@form :globalMessage">
                        <f:passThroughAttribute
                            name="aria-label"
                            value="#{msgs.plugin_administration_deliveryManagement_uploadFile}" />
                    </p:fileUpload>

                    <!-- PAGINATOR -->
                    <div class="dataTables_paginate">
                        <intranda:tablePaginator
                            id="users"
                            paginator="#{AdministrationForm.administrationPlugin.userPaginator}" />
                    </div>
                </div>

            </h:panelGroup>


            <!-- EDIT MODE -->
            <h:panelGroup
                layout="block"
                styleClass="dataTables_wrapper edit-mode col-md-12"
                rendered="#{AdministrationForm.administrationPlugin.editionMode=='edit'}">
                <div class="tab-content">

                    <!-- LASTNAME -->
                    <intranda:formInputTextAjax
                        classLeft="col-sm-3 control-label notFocusable"
                        id="lastname"
                        label="#{msgs.nachname}"
                        field="#{AdministrationForm.administrationPlugin.user.nachname}"
                        help="#{msgs.helpNachname}"
                        name="nachname"
                        fieldStyle="form-control"
                        execute="@this"
                        render="@form" />

                    <!-- FIRST NAME -->
                    <intranda:formInputTextAjax
                        classLeft="col-sm-3 control-label notFocusable"
                        id="firstname"
                        label="#{msgs.vorname}"
                        field="#{AdministrationForm.administrationPlugin.user.vorname}"
                        help="#{msgs.helpVorname}"
                        name="vorname"
                        fieldStyle="form-control"
                        execute="@this"
                        render="@form" />

                    <!-- PLACE -->
                    <intranda:formInputTextAjax
                        classLeft="col-sm-3 control-label notFocusable"
                        id="location"
                        label="#{msgs.standort}"
                        field="#{AdministrationForm.administrationPlugin.user.standort}"
                        help="#{msgs.helpStandort}"
                        name="standort"
                        fieldStyle="form-control"
                        execute="@this"
                        render="@form" />

                    <!-- LOGIN -->
                    <div class="form-group">
                        <div class="col-sm-3 control-label">
                            <h:outputLabel
                                for="loginAs"
                                value="#{msgs.login}">
                            </h:outputLabel>
                            <h:panelGroup rendered="#{item.required}">
                                <span
                                    class="fa fa-asterisk pull-right font-asterisk"
                                    data-bs-original-title="#{msgs.requiredField}"
                                    data-toggle="tooltip" />
                            </h:panelGroup>

                        </div>
                        <div class="col-sm-9">
                            <x:inputText
                                id="loginAs"
                                forceId="true"
                                styleClass="form-control"
                                value="#{AdministrationForm.administrationPlugin.user.login}"
                                required="true"
                                readonly="false"
                                validatorMessage="#{msgs.loginWrongCharacter}">
                                <f:validateRegex pattern="[a-z0-9\._-]+" />
                                <f:ajax
                                    render="@form"
                                    execute="@this" />
                            </x:inputText>
                            <h:message
                                for="loginAs"
                                showDetail="true"
                                styleClass="help-inline font-danger" />
                            <intranda:formHelp content="#{msgs.helpLogin}" />
                        </div>
                    </div>

                    <!-- EMAIL -->
                    <intranda:formInputTextAjax
                        classLeft="col-sm-3 control-label notFocusable"
                        id="email"
                        label="#{msgs.email}"
                        field="#{AdministrationForm.administrationPlugin.user.email}"
                        help="#{msgs.helpEmail}"
                        required="false"
                        name="emailName"
                        fieldStyle="form-control"
                        execute="@this"
                        render="@form" />


                    <!-- AUTH -->
                    <div class="form-group">
                        <div class="col-sm-3 control-label">
                            <h:outputLabel
                                for="ldapGruppe"
                                value="#{msgs.user_edit_loginType}">
                            </h:outputLabel>
                            <h:panelGroup rendered="#{item.required}">
                                <span
                                    class="fa fa-asterisk pull-right font-asterisk"
                                    data-bs-original-title="#{msgs.requiredField}"
                                    data-toggle="tooltip" />
                            </h:panelGroup>
                        </div>
                        <div class="col-sm-9">
                            <h:selectOneMenu
                                id="ldapGruppe"
                                styleClass="form-control"
                                value="#{AdministrationForm.administrationPlugin.authenticationType}">
                                <f:selectItems
                                    value="#{BenutzerverwaltungForm.ldapGruppeAuswahlListe}"
                                    var="var"
                                    itemLabel="#{var.itemLabel}"
                                    itemValue="#{var.itemValue}" />
                                <f:ajax
                                    render="@form"
                                    execute="@this" />
                            </h:selectOneMenu>
                            <h:message
                                for="ldapGruppe"
                                showDetail="true"
                                styleClass="help-inline font-danger" />
                            <intranda:formHelp content="#{msgs.helpLdapGruppe}" />
                        </div>
                    </div>

                    <!-- ACCOUNT STATUS -->
                    <div class="form-group">
                        <div class="col-sm-3 control-label">
                            <h:outputLabel
                                for="status"
                                value="#{msgs.plugin_administration_deliveryManagement_accountStatus}">
                            </h:outputLabel>
                        </div>
                        <div class="col-sm-9">
                            <h:selectOneRadio
                                id="status"
                                styleClass="form-control accountStatus__options__table"
                                value="#{AdministrationForm.administrationPlugin.userStatus}"
                                onfocus="focusField(this);">

                                <f:selectItems
                                    value="#{AdministrationForm.administrationPlugin.possibleUserStatus}"
                                    itemLabel="#{msgs[val]}"
                                    itemValue="#{val}"
                                    var="val" />
                            </h:selectOneRadio>
                            <h:message
                                for="status"
                                showDetail="true"
                                styleClass="help-inline font-danger" />
                            <intranda:formHelp content="#{msgs.helpIstAktiv}" />
                        </div>
                    </div>

                    <!-- DASHBOARD -->
                    <intranda:formInputDropDownAjax
                        classLeft="col-sm-3 control-label notFocusable"
                        id="dashboard"
                        label="#{msgs.dashboard}"
                        field="#{AdministrationForm.administrationPlugin.user.dashboardPlugin}"
                        help="#{msgs.helpUserDashboard}"
                        name="dashboardName"
                        selectItems="#{AdministrationForm.administrationPlugin.user.availableDashboards}"
                        fieldStyle="form-control"
                        ajaxEvent="change"
                        ajaxRender="@form" />

                    <!-- TODO add separate area for dnb data -->


                    <!-- ADDITIONAL DATA -->
                    <ui:repeat
                        var="item"
                        varStatus="status"
                        value="#{AdministrationForm.administrationPlugin.configuredUserFields}">
                        <ui:fragment rendered="#{item.fieldType=='input'}">
                            <intranda:formInputTextAjax
                                name="#{status.index}field"
                                label="#{msgs[item.label]}"
                                field="#{item.value}"
                                help="#{item.helpMessage}"
                                fieldStyle="form-control"
                                required="#{item.required}"
                                execute="@this"
                                render="@form" />
                        </ui:fragment>
                        <ui:fragment rendered="#{item.fieldType=='textarea'}">
                            <intranda:formInputTextArea
                                name="#{status.index}field"
                                label="#{msgs[item.label]}"
                                field="#{item.value}"
                                help="#{item.helpMessage}"
                                fieldStyle="form-control"
                                required="#{item.required}" />
                        </ui:fragment>
                        <ui:fragment rendered="#{item.fieldType=='dropdown'}">
                            <intranda:formInputDropDownAjax
                                label="#{msgs[item.label]}"
                                field="#{item.value}"
                                help="#{item.helpMessage}"
                                name="#{status.index}field"
                                selectItems="#{item.selectItemList}"
                                fieldStyle="form-control"
                                required="#{item.required}"
                                itemValue="#{var.value}"
                                itemLabel="#{msgs[var.label]}"
                                ajaxEvent="change"
                                ajaxRender="@form" />
                        </ui:fragment>


                        <ui:fragment rendered="#{item.fieldType=='combo'}">
                            <div class="form-group">
                                <div
                                    class="col-sm-3 control-label"
                                    tabindex="-1">
                                    <h:outputLabel
                                        for="id"
                                        value="#{msgs[item.label]}" />
                                </div>
                                <div class="col-sm-9">
                                    <h:panelGroup
                                        id="combo"
                                        rendered="#{item.fieldType=='combo'}">
                                        <h:selectBooleanCheckbox
                                            id="combo1"
                                            styleClass="form-control"
                                            value="#{item.booleanValue}">
                                            <f:ajax
                                                render="@form"
                                                execute="@this" />
                                        </h:selectBooleanCheckbox>
                                        <h:selectOneRadio
                                            rendered="#{item.booleanValue}"
                                            id="combo2"
                                            styleClass="form-control"
                                            value="#{item.subValue}">

                                            <f:selectItems
                                                value="#{item.selectItemList}"
                                                itemValue="#{var.value}"
                                                itemLabel="#{msgs[var.label]}"
                                                var="val" />
                                            <f:ajax
                                                render="@form"
                                                execute="@this" />
                                        </h:selectOneRadio>
                                    </h:panelGroup>
                                    <intranda:formHelp content="#{item.helpMessage}" />
                                </div>

                            </div>
                        </ui:fragment>
                    </ui:repeat>
                    <h:panelGroup
                        layout="block"
                        styleClass="box-title"
                        rendered="#{AdministrationForm.administrationPlugin.currentUser.dnbUser}">
                        <h2>
                            <h:outputText value="#{msgs.plugin_rest_usercreation_dnb_data}" />
                        </h2>
                    </h:panelGroup>
                    <ui:repeat
                        rendered="#{AdministrationForm.administrationPlugin.currentUser.dnbUser}"
                        var="item"
                        varStatus="status"
                        value="#{AdministrationForm.administrationPlugin.configuredDnbFields}">

                                           <ui:fragment rendered="#{item.fieldType=='input'}">
                            <intranda:formInputTextAjax
                                name="#{status.index}field"
                                label="#{msgs[item.label]}"
                                field="#{item.value}"
                                help="#{item.helpMessage}"
                                fieldStyle="form-control"
                                required="#{item.required}"
                                execute="@this"
                                render="@form" />
                        </ui:fragment>
                        <ui:fragment rendered="#{item.fieldType=='textarea'}">
                            <intranda:formInputTextArea
                                name="#{status.index}field"
                                label="#{msgs[item.label]}"
                                field="#{item.value}"
                                help="#{item.helpMessage}"
                                fieldStyle="form-control"
                                required="#{item.required}" />
                        </ui:fragment>
                        <ui:fragment rendered="#{item.fieldType=='dropdown'}">
                            <intranda:formInputDropDownAjax
                                label="#{msgs[item.label]}"
                                field="#{item.value}"
                                help="#{item.helpMessage}"
                                name="#{status.index}field"
                                selectItems="#{item.selectItemList}"
                                fieldStyle="form-control"
                                required="#{item.required}"
                                itemValue="#{var.value}"
                                itemLabel="#{msgs[var.label]}"
                                ajaxEvent="change"
                                ajaxRender="@form" />
                        </ui:fragment>
                        <br/>

                    </ui:repeat>

                    <div class="box-title">
                        <h2>
                            <h:outputText value="#{msgs.plugin_rest_usercreation_new_institution}" />
                        </h2>
                    </div>
                    <intranda:formInputTextAjax
                        label="#{msgs.institution_shortName}"
                        field="#{AdministrationForm.administrationPlugin.institution.shortName}"
                        help="#{msgs.institution_help_shortName}"
                        name="shortName"
                        fieldStyle="form-control"
                        execute="@this"
                        render="@form" />
                    <intranda:formInputTextAjax
                        name="longTitle"
                        label="#{msgs.institution_longName}"
                        field="#{AdministrationForm.administrationPlugin.institution.longName}"
                        help="#{msgs.institution_help_longName}"
                        fieldStyle="form-control"
                        execute="@this"
                        render="@form" />


                    <!-- additional data -->
                    <c:forEach
                        items="#{AdministrationForm.administrationPlugin.configuredInstitutionFields}"
                        var="entry">

                        <ui:fragment rendered="#{entry.key!='page3a' or AdministrationForm.administrationPlugin.displaySecondContact}">
                            <div
                                class="box-title"
                                jsf:rendered="#{entry.key!='page2'}">
                                <h2>
                                    <h:outputText
                                        rendered="#{entry.key=='page2'}"
                                        value="#{msgs.plugin_rest_usercreation_new_institution}" />
                                    <h:outputText
                                        rendered="#{entry.key=='page3'}"
                                        value="#{msgs.plugin_rest_usercreation_new_contact}" />
                                    <h:outputText
                                        rendered="#{entry.key=='page3a'}"
                                        value="#{msgs.plugin_rest_usercreation_new_contact}" />

                                    <h:outputText
                                        rendered="#{entry.key=='page4'}"
                                        value="#{msgs.plugin_rest_usercreation_new_additionalData}" />
                                </h2>
                                <button
                                    jsf:rendered="#{!AdministrationForm.administrationPlugin.displaySecondContact and entry.key=='page3'}"
                                    jsf:id="createNewContact"
                                    jsf:action="#{AdministrationForm.administrationPlugin.createNewContact}"
                                    style="margin-bottom: 20px;"
                                    class="btn btn-link ms-auto pull-right users__title-btn">

                                    <ui:include src="/uii/includes/icon-plus.xhtml" />
                                    <span>
                                        <h:outputText value="#{msgs.plugin_rest_usercreation_new_createNewContact}" />
                                    </span>
                                </button>

                                <button
                                    jsf:rendered="#{entry.key=='page3a'}"
                                    jsf:id="disableContact"
                                    jsf:action="#{AdministrationForm.administrationPlugin.disableContact}"
                                    style="float: right"
                                    class="btn btn-link ms-auto pull-right users__title-btn">

                                    <span>
                                        <h:outputText value="#{msgs.plugin_rest_usercreation_new_disableContact}" />
                                    </span>
                                </button>
                            </div>
                            <ui:repeat
                                var="item"
                                value="#{entry.value}"
                                varStatus="status">

                                <div class="form-group">
                                    <div
                                        class="col-sm-3 control-label"
                                        tabindex="-1">
                                        <h:outputLabel
                                            for="#{status.index}field"
                                            value="#{msgs[item.label]}">
                                        </h:outputLabel>
                                        <h:panelGroup rendered="#{item.required}">
                                            <span
                                                class="fa fa-asterisk pull-right font-asterisk"
                                                data-bs-original-title="#{msgs.requiredField}"
                                                data-toggle="tooltip" />
                                        </h:panelGroup>
                                    </div>
                                    <div class="col-sm-9">
                                        <x:inputText
                                            rendered="#{item.fieldType=='input'}"
                                            pt:aria-label="#{msgs[item.label]}"
                                            styleClass="form-control"
                                            value="#{item.value}"
                                            validator="#{item.validateField}"
                                            onfocus="focusField(this);">
                                            <f:ajax
                                                event="blur"
                                                render="@form"
                                                execute="@this focusField" />
                                            <f:passThroughAttribute
                                                name="placeholder"
                                                value="#{msgs[item.placeholderText]}" />
                                        </x:inputText>

                                        <x:inputTextarea
                                            rendered="#{item.fieldType=='textarea'}"
                                            pt:aria-label="#{msgs[item.label]}"
                                            styleClass="form-control"
                                            value="#{item.value}"
                                            validator="#{item.validateField}"
                                            onfocus="focusField(this);">
                                            <f:ajax
                                                event="blur"
                                                render="@form"
                                                execute="@this focusField" />
                                            <f:passThroughAttribute
                                                name="placeholder"
                                                value="#{msgs[item.placeholderText]}" />
                                        </x:inputTextarea>

                                        <h:selectOneMenu
                                            rendered="#{item.fieldType=='dropdown'}"
                                            pt:aria-label="#{msgs[item.label]}"
                                            styleClass="form-control"
                                            value="#{item.value}"
                                            validator="#{item.validateField}"
                                            onfocus="focusField(this);">
                                            <f:selectItems
                                                value="#{item.selectItemList}"
                                                itemValue="#{var.value}"
                                                itemLabel="#{msgs[var.label]}"
                                                var="val" />
                                        </h:selectOneMenu>

                                        <ui:fragment rendered="#{item.fieldType=='combo'}">
                                            <h:panelGroup id="combo">
                                                <h:selectBooleanCheckbox
                                                    id="combo1"
                                                    styleClass="form-control"
                                                    value="#{item.booleanValue}"
                                                    validator="#{item.validateField}"
                                                    onfocus="focusField(this);">
                                                    <f:ajax
                                                        render="@form"
                                                        execute="@this focusField" />
                                                </h:selectBooleanCheckbox>
                                                <h:selectOneRadio
                                                    rendered="#{item.booleanValue}"
                                                    id="combo2"
                                                    styleClass="form-control"
                                                    value="#{item.subValue}"
                                                    validator="#{item.validateField}"
                                                    onfocus="focusField(this);">
                                                    <f:ajax
                                                        render="@form"
                                                        execute="@this focusField" />
                                                    <f:selectItems
                                                        value="#{item.selectItemList}"
                                                        itemValue="#{var.value}"
                                                        itemLabel="#{msgs[var.label]}"
                                                        var="val" />
                                                </h:selectOneRadio>
                                            </h:panelGroup>
                                        </ui:fragment>

                                        <h:panelGroup
                                            layout="block"
                                            rendered="#{!item.fieldValid}"
                                            styleClass="font-danger validation-message">
                                            <h:outputText value="#{item.validationError}" />
                                        </h:panelGroup>
                                        <h:outputText
                                            styleClass="help-block font-light"
                                            rendered="#{NavigationForm.showHelp}"
                                            value="#{item.helpMessage}" />




                                        <h:message
                                            for="#{status.index}field"
                                            showDetail="true"
                                            styleClass="help-inline font-danger" />
                                        <intranda:formHelp content="#{item.helpMessage}" />
                                    </div>
                                </div>
                            </ui:repeat>
                        </ui:fragment>
                    </c:forEach>
                </div>


                <div class="form-actions">
                    <!-- Save -->
                    <button
                        class="btn btn-success submitOnEnter pull-right font-size-s margin-bottom-most"
                        jsf:id="absenden"
                        type="submit"
                        jsf:action="#{AdministrationForm.administrationPlugin.saveUser}">
                        <span class="fa fa-save margin-right-5" />
                        <h:outputText value="#{msgs.speichern}" />
                        <f:ajax
                            render="@all"
                            execute="@form" />
                    </button>

                    <!-- Cancel -->
                    <button
                        class="btn margin-sides-10 font-size-s pull-right"
                        jsf:id="cancel"
                        type="submit"
                        jsf:immediate="true">
                        <h:outputText value="#{msgs.abbrechen}" />
                        <f:setPropertyActionListener
                            value=""
                            target="#{AdministrationForm.administrationPlugin.editionMode}" />
                        <f:ajax render="@all" />
                    </button>
                    <!-- delete -->
                    <ui:fragment rendered="#{AdministrationForm.administrationPlugin.user.id != null}">
                        <button
                            id="delete"
                            type="button"
                            class="btn btn-danger"
                            data-toggle="modal"
                            data-target="#deleteModal">
                            <span class="fa fa-trash-o margin-right-5" />
                            <h:outputText value="#{msgs.loeschen}" />
                        </button>
                        <div
                            class="modal fade"
                            id="deleteModal"
                            tabindex="-1"
                            role="dialog"
                            aria-labelledby="myModalLabel">
                            <div
                                class="modal-dialog"
                                role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h4
                                            class="modal-title"
                                            id="myModalLabel">
                                            <h:outputText value="#{msgs.loeschen}" />
                                        </h4>
                                    </div>
                                    <div class="modal-body">
                                        <p>#{msgs.sollDieserEintragWirklichGeloeschtWerden}</p>
                                    </div>
                                    <div class="modal-footer">
                                        <button
                                            class="btn"
                                            data-dismiss="modal"
                                            aria-hidden="true">#{msgs.abbrechen}</button>
                                        <button
                                            jsf:id="confirmDelete"
                                            class="btn btn-danger"
                                            jsf:action="#{AdministrationForm.administrationPlugin.deleteUser}">
                                            <span class="fa fa-trash-o margin-right-5" />
                                            <f:setPropertyActionListener
                                                value=""
                                                target="#{AdministrationForm.administrationPlugin.editionMode}" />
                                            <h:outputText value="#{msgs.loeschen}" />
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ui:fragment>
                </div>

            </h:panelGroup>






            <!-- LIST OF IMPORTS MODE -->
            <h:panelGroup
                layout="block"
                styleClass="dataTables_wrapper col-md-12 edit-mode"
                rendered="#{AdministrationForm.administrationPlugin.editionMode=='imports'}">


                <div class="dataTables_length">
                    <h:outputText value="#{AdministrationForm.administrationPlugin.institution.longName} / #{msgs.treffer}: #{AdministrationForm.administrationPlugin.institutionProcessPaginator.totalResults}" />
                </div>

                <div class="dataTables_filter">
                    <div class="input-group input-group">
                        <span class="input-group-addon">
                            <span class="fa fa-search" />
                        </span>
                        <h:inputText
                            id="processsearchfield"
                            styleClass="form-control searchfield"
                            value="#{AdministrationForm.administrationPlugin.processSearchField}">
                        </h:inputText>
                        <div class="input-group-btn">
                            <button
                                jsf:id="processsearchButton"
                                jsf:forceId="true"
                                class="btn"
                                style="text-align: center; line-height: 100%; padding: 0px 10px"
                                jsf:action="#{AdministrationForm.administrationPlugin.generateInstitutionProcessTitleList}">#{msgs.search}</button>
                        </div>
                    </div>
                    <x:commandButton
                        type="submit"
                        id="processsearchButton2"
                        forceId="true"
                        style="display:none"
                        action="#{AdministrationForm.administrationPlugin.generateInstitutionProcessTitleList}" />
                </div>


                <table
                    role="grid"
                    id="processTable"
                    class="table table-hover table-nomargin dataTable table-bordered responsive">
                    <!-- ### Columnheader row ### -->
                    <thead>
                        <tr role="row">


                            <!-- Embedded Metadata -->
                            <intranda:columnheader
                                addClass="tableColumnOverflow maxWidth300"
                                value="#{msgs.metadata}"
                                sortable="false" />

                            <th
                                scope="col"
                                role="columnheader"
                                class="tableColumnOverflow maxWidth300"
                                aria-sort="#{AdministrationForm.administrationPlugin.sortField== 'titelDesc' ? 'descending' : AdministrationForm.administrationPlugin.sortField== 'titelAsc' ? 'ascending' :'none'}">
                                <button
                                    class="button-link"
                                    style="width: 100%; text-align: left;"
                                    jsf:action="#{AdministrationForm.administrationPlugin.generateInstitutionProcessTitleList}"
                                    aria-label="#{msgs.defaultSortField} #{msgs.prozessTitel} #{AdministrationForm.administrationPlugin.sortField== 'titelDesc' ? msgs.defaultSortFieldDesc : BenutzerverwaltungForm.sortierung== 'titelAsc' ? msgs.defaultSortFieldAsc : msgs.defaultSortFieldNotSorted }">
                                    <h:outputText value="#{msgs.prozessTitel}" />
                                    <span class="pull-right table-sort-icon fa #{AdministrationForm.administrationPlugin.sortField== 'titelDesc' ?'fa-sort-desc':AdministrationForm.administrationPlugin.sortField== 'titelAsc' ?'fa-sort-asc':'fa-sort'}"></span>
                                    <f:setPropertyActionListener
                                        target="#{AdministrationForm.administrationPlugin.sortField}"
                                        value="#{AdministrationForm.administrationPlugin.sortField== 'titelAsc' ? 'titelDesc' : 'titelAsc' }" />
                                    <f:ajax render="@form" />
                                </button>
                            </th>


                            <th
                                scope="col"
                                role="columnheader"
                                class="tableColumnOverflow maxwidth200"
                                aria-sort="#{AdministrationForm.administrationPlugin.sortField== 'creationDateDesc' ? 'descending' : AdministrationForm.administrationPlugin.sortField== 'creationDateAsc' ? 'ascending' :'none'}">
                                <button
                                    class="button-link"
                                    style="width: 100%; text-align: left;"
                                    jsf:action="#{AdministrationForm.administrationPlugin.generateInstitutionProcessTitleList}"
                                    aria-label="#{msgs.defaultSortField} #{msgs.prozessTitel} #{AdministrationForm.administrationPlugin.sortField== 'creationDateDesc' ? msgs.defaultSortFieldDesc : BenutzerverwaltungForm.sortierung== 'creationDateAsc' ? msgs.defaultSortFieldAsc : msgs.defaultSortFieldNotSorted }">
                                    <h:outputText value="#{msgs.vorgangsdatum}" />
                                    <span class="pull-right table-sort-icon fa #{AdministrationForm.administrationPlugin.sortField== 'creationDateDesc' ?'fa-sort-desc':AdministrationForm.administrationPlugin.sortField== 'creationDateAsc' ?'fa-sort-asc':'fa-sort'}"></span>
                                    <f:setPropertyActionListener
                                        target="#{AdministrationForm.administrationPlugin.sortField}"
                                        value="#{AdministrationForm.administrationPlugin.sortField== 'creationDateAsc' ? 'creationDateDesc' : 'creationDateAsc' }" />
                                    <f:ajax render="@form" />
                                </button>
                            </th>






                            <!-- Buttons -->
                            <intranda:columnheader
                                addClass="width200"
                                value="#{msgs.auswahl}"
                                sortable="false" />
                        </tr>
                    </thead>
                    <ui:repeat
                        var="zdbItem"
                        value="#{AdministrationForm.administrationPlugin.institutionProcessPaginator.list}"
                        varStatus="status">
                        <tr role="row">

                            <!-- Embedded Metadata -->
                            <td>


                                <table class="table table-borderless">
                                    <ui:repeat
                                        var="metadata"
                                        value="#{AdministrationForm.administrationPlugin.metadataDisplayList}"
                                        varStatus="metadatastatus">
                                        <ui:fragment rendered="#{zdbItem.getMetadataValue(metadata) != ''}">
                                            <tr>
                                                <td
                                                    style="width: 100px;"
                                                    class="tableColumnWidth100 smallertablecell">
                                                    <h:outputText value="#{msgs['process_grid_'.concat(metadata)]}:" />
                                                </td>
                                                <td
                                                    style="width: 200px;"
                                                    class="tableColumnWidthLong smallertablecell">
                                                    <h:outputText value="#{zdbItem.getMetadataValue(metadata)}" />
                                                </td>
                                            </tr>
                                        </ui:fragment>
                                    </ui:repeat>
                                </table>

                            </td>


                            <td>
                                <h:outputText value="#{zdbItem.titel}" />
                            </td>

                            <!-- Vorgangsdatum -->
                            <td>
                                <h:outputText value="#{zdbItem.erstellungsdatumAsString}">
                                </h:outputText>
                            </td>

                            <!-- Buttons -->
                            <td class="width200">
                                <!-- Metadaten-Schaltknopf - Allow writing -->
                                <h:commandLink
                                    action="#{AdministrationForm.administrationPlugin.openProcess(false)}"
                                    id="action15"
                                    rel="tooltip"
                                    title="#{msgs.metadatenBearbeiten}"
                                    pt:aria-label="#{msgs.metadatenBearbeiten}">
                                    <span class="btn fa fa-book " />
                                    <f:passThroughAttribute
                                        name="data-toggle"
                                        value="tooltip" />
                                    <f:setPropertyActionListener
                                        value="editProcess"
                                        target="#{AdministrationForm.administrationPlugin.editionMode}" />
                                    <f:setPropertyActionListener
                                        value="#{zdbItem}"
                                        target="#{AdministrationForm.administrationPlugin.process}" />

                                </h:commandLink>



                            </td>
                        </tr>
                    </ui:repeat>
                </table>


                <!-- BUTTON ROW -->
                <div class="dataTables_info">
                    <button
                        class="btn margin-sides-10 font-size-s"
                        jsf:id="cancelImports"
                        type="submit"
                        jsf:immediate="true">
                        <h:outputText value="#{msgs.plugin_administration_deliveryManagement_backToList}" />
                        <f:setPropertyActionListener
                            value=""
                            target="#{AdministrationForm.administrationPlugin.editionMode}" />
                        <f:ajax render="@all" />
                    </button>

                    <div class="dataTables_paginate">

                        <ui:fragment id="zdb_paginator">
                            <!-- paginator -->
                            <h:panelGroup rendered="#{AdministrationForm.administrationPlugin.institutionProcessPaginator.totalResults > LoginForm.myBenutzer.tabellengroesse}">

                                <div class="pull-right">

                                    <button
                                        class="btn font-size-s margin-sides-10"
                                        aria-label="#{msgs.firstPage}"
                                        jsf:action="#{AdministrationForm.administrationPlugin.institutionProcessPaginator.cmdMoveFirst}"
                                        jsf:id="navfirst">
                                        <span class="fa fa-angle-double-left" />
                                        <f:ajax render="@form" />
                                    </button>
                                    <button
                                        class="btn btn-primary font-size-s navigator-previous"
                                        jsf:action="#{AdministrationForm.administrationPlugin.institutionProcessPaginator.cmdMovePrevious}"
                                        jsf:id="navprev">
                                        <span class="fa fa-angle-left" />
                                        <h:outputText value=" #{msgs.pagePrevious}" />
                                        <f:ajax render="@form" />
                                    </button>

                                    <div class="margin-sides-10">
                                        <!-- aktuelle Seite anzeigen -->
                                        <x:outputText
                                            id="item_txtMoveTo1"
                                            forceId="true"
                                            value="#{msgs.seite} #{AdministrationForm.administrationPlugin.institutionProcessPaginator.pageNumberCurrent} #{msgs.von} #{AdministrationForm.administrationPlugin.institutionProcessPaginator.pageNumberLast}"
                                            onclick="document.getElementById('item_txtMoveTo2').style.display='inline';
	                   document.getElementById('item_txtMoveTo1').style.display='none';
	                   document.getElementById('item_txtMoveTo2').focus();
	                   document.getElementById('item_txtMoveTo2').select();" />

                                        <!-- Seite direkt anspringen -->
                                        <x:inputText
                                            id="item_txtMoveTo2"
                                            forceId="true"
                                            value="#{AdministrationForm.administrationPlugin.institutionProcessPaginator.txtMoveTo}"
                                            style="display:none;width:30px"
                                            required="true"
                                            onblur="document.getElementById('item_txtMoveTo2').style.display='none';document.getElementById('item_txtMoveTo1').style.display='inline';"
                                            onkeypress="return submitEnter('item_cmdMoveTo',event)" />
                                        <x:commandButton
                                            action="#{NavigationForm.Reload}"
                                            id="item_cmdMoveTo"
                                            forceId="true"
                                            value="go"
                                            style="display:none">
                                        </x:commandButton>
                                    </div>

                                    <button
                                        class="btn btn-primary font-size-s navigator-next"
                                        jsf:action="#{AdministrationForm.administrationPlugin.institutionProcessPaginator.cmdMoveNext}"
                                        jsf:id="navnext">
                                        <h:outputText value="#{msgs.pageNext} " />
                                        <span class="fa fa-angle-right" />
                                        <f:ajax render="@form" />
                                    </button>
                                    <button
                                        class="btn font-size-s margin-sides-10"
                                        aria-label="#{msgs.lastPage}"
                                        jsf:action="#{AdministrationForm.administrationPlugin.institutionProcessPaginator.cmdMoveLast}"
                                        jsf:id="navlast">
                                        <span class="fa fa-angle-double-right" />
                                        <f:ajax render="@form" />
                                    </button>
                                </div>
                            </h:panelGroup>
                        </ui:fragment>
                    </div>


                </div>
            </h:panelGroup>


            <h:panelGroup
                layout="block"
                styleClass="dataTables_wrapper edit-mode"
                rendered="#{AdministrationForm.administrationPlugin.editionMode=='editProcess'}">

                <ui:repeat
                    var="meta"
                    value="#{AdministrationForm.administrationPlugin.metadataList}"
                    varStatus="status">


                    <intranda:formInputText
                        id="id_#{status.index}"
                        name="meta"
                        label="#{meta.type.getLanguage(SpracheForm.locale.language)}"
                        field="#{meta.value}"
                        help="#{msgs.helpProcessTitle}"
                        fieldStyle="form-control"
                        required="false" />
                </ui:repeat>


                <div class="form-actions">

                    <!-- Save -->
                    <button
                        class="btn btn-success submitOnEnter pull-right font-size-s margin-bottom-most"
                        jsf:id="saveProcessEdition"
                        type="submit"
                        jsf:action="#{AdministrationForm.administrationPlugin.saveZdbTitleData}">
                        <span class="fa fa-save margin-right-5" />
                        <h:outputText value="#{msgs.speichern}" />
                        <f:setPropertyActionListener
                            value=""
                            target="#{AdministrationForm.administrationPlugin.editionMode}" />
                    </button>

                    <!-- Cancel -->
                    <button
                        class="btn margin-sides-10 font-size-s pull-right"
                        jsf:id="cancelProcessEdition"
                        type="submit"
                        jsf:immediate="true">
                        <h:outputText value="#{msgs.abbrechen}" />
                        <f:setPropertyActionListener
                            value=""
                            target="#{AdministrationForm.administrationPlugin.editionMode}" />
                    </button>
                </div>
            </h:panelGroup>
        </h:form>
    </composite:implementation>

</ui:composition>
