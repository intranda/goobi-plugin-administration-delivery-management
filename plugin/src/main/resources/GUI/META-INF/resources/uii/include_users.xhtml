<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:composite="http://xmlns.jcp.org/jsf/composite"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:x="http://myfaces.apache.org/tomahawk"
    xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
    xmlns:jsf="http://xmlns.jcp.org/jsf"
    xmlns:c="http://java.sun.com/jstl/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:intranda="http://xmlns.jcp.org/jsf/composite/compositesPG">

    <composite:interface>
    </composite:interface>

    <composite:implementation>

        <h:form>
            <!-- USER TABLE -->
            <div class="gw-table"
                rendered="#{AdministrationForm.administrationPlugin.editionMode==''}">
                <div class="gw-table__search">
                    <div class="gw-table__search__length">
                        <h:outputText value="#{msgs.treffer}: #{AdministrationForm.administrationPlugin.userPaginator.totalResults}" />
                    </div>
                    <div class="gw-table__filters">
                        <h:form id="showAllUsers">
                            <button
                                jsf:id="excludeActiveUsers"
                                class="btn gw-table__filters__option"
                                jsf:action="#{AdministrationForm.administrationPlugin.filterUser}"
                                jsf:immediate="true">
                                <i class="fa #{AdministrationForm.administrationPlugin.showOnlyInactiveUser?'fa-square-o':'fa-check-square-o'}" />
                                <h:outputText
                                    styleClass="font-size-s"
                                    value="#{msgs.plugin_administration_deliveryManagement_showAllUsers}" />
                                <f:setPropertyActionListener
                                    target="#{AdministrationForm.administrationPlugin.showOnlyInactiveUser}"
                                    value="#{not AdministrationForm.administrationPlugin.showOnlyInactiveUser}" />
                            </button>
                        </h:form>
                        <div class="gw-table__filters__search-bar">
                            <h:form
                                id="searchform"
                                styleClass="search-form">
                                    <div class="input-group">
                                        <span class="input-group-text">
                                            <i class="fa fa-search" />
                                        </span>
                                        <h:inputText
                                            id="searchfield"
                                            styleClass="form-control searchfield"
                                            value="#{AdministrationForm.administrationPlugin.userSearchFilter}">
                                            <f:passThroughAttribute
                                                name="placeholder"
                                                value="#{msgs.benutzer}" />
                                            <f:passThroughAttribute
                                                name="aria-label"
                                                value="#{msgs.benutzer}" />
                                        </h:inputText>
                                        <button
                                        jsf:id="FilterAlle2"
                                        jsf:forceId="true"
                                        class="btn btn-blank"
                                        style="text-align: center; line-height: 100%; padding: 0px 10px"
                                        jsf:action="#{AdministrationForm.administrationPlugin.filterUser}">#{msgs.search}</button>
                                    </div>
                                    <x:commandButton
                                        type="submit"
                                        id="FilterAlle"
                                        forceId="true"
                                        style="display:none"
                                        action="#{AdministrationForm.administrationPlugin.filterUser}" />
                            </h:form>
                        </div>
                    </div>
                </div>

                <h:form
                    id="userTable"
                    prependId="false">
                    <div class="gw-table gw-table-fixed">
                        <table
                            role="grid"
                            id="tableUsers"
                            class="table table-bordered table-hover">
                            <thead>
                                <tr role="row">
                                    <!-- NAME HEADER -->
                                    <intranda:columnheader
                                        value="#{msgs.plugin_administration_deliveryManagement_name}"
                                        form="#{AdministrationForm.administrationPlugin}"
                                        name="name"
                                        ajaxRender="@form"
                                        sortField="#{AdministrationForm.administrationPlugin.userSort}"
                                        sortMethod="#{AdministrationForm.administrationPlugin.filterUser}" />
                                    <!-- <th>
                                        <button
                                            class="button-link"
                                            style="width: 100%; text-align: left;"
                                            jsf:action="#{AdministrationForm.administrationPlugin.filterUser}">
                                            <h:outputText value="#{msgs.plugin_administration_deliveryManagement_name}" />
                                            <span class="pull-right table-sort-icon fa #{AdministrationForm.administrationPlugin.userSort== 'benutzer.Nachname Desc, benutzer.Vorname Desc' ?'fa-sort-desc':AdministrationForm.administrationPlugin.userSort== 'benutzer.Nachname, benutzer.Vorname' ?'fa-sort-asc':'fa-sort'}"></span>
                                            <f:setPropertyActionListener
                                                target="#{AdministrationForm.administrationPlugin.userSort}"
                                                value="#{AdministrationForm.administrationPlugin.userSort== 'benutzer.Nachname, benutzer.Vorname' ? 'benutzer.Nachname Desc, benutzer.Vorname Desc' : 'benutzer.Nachname, benutzer.Vorname' }" />
                                            <f:ajax render="@form" />
                                        </button>
                                    </th> -->
                                    <!-- LOGIN HEADER -->
                                    <th>
                                        <button
                                            class="button-link"
                                            style="width: 100%; text-align: left;"
                                            jsf:action="#{AdministrationForm.administrationPlugin.filterUser}">
                                            <h:outputText value="#{msgs.login}" />
                                            <span class="pull-right table-sort-icon fa #{AdministrationForm.administrationPlugin.userSort== 'benutzer.login Desc' ?'fa-sort-desc':AdministrationForm.administrationPlugin.userSort== 'benutzer.login' ?'fa-sort-asc':'fa-sort'}"></span>
                                            <f:setPropertyActionListener
                                                target="#{AdministrationForm.administrationPlugin.userSort}"
                                                value="#{AdministrationForm.administrationPlugin.userSort== 'benutzer.login' ? 'benutzer.login Desc' : 'benutzer.login' }" />
                                            <f:ajax render="@form" />
                                        </button>
                                    </th>
                                    <!-- EMAIL HEADER -->
                                    <th>
                                        <button
                                            class="button-link"
                                            style="width: 100%; text-align: left;"
                                            jsf:action="#{AdministrationForm.administrationPlugin.filterUser}">
                                            <h:outputText value="#{msgs.email}" />
                                            <span class="pull-right table-sort-icon fa #{AdministrationForm.administrationPlugin.userSort== 'benutzer.email Desc' ?'fa-sort-desc':AdministrationForm.administrationPlugin.userSort== 'benutzer.email' ?'fa-sort-asc':'fa-sort'}"></span>
                                            <f:setPropertyActionListener
                                                target="#{AdministrationForm.administrationPlugin.userSort}"
                                                value="#{AdministrationForm.administrationPlugin.userSort== 'benutzer.email' ? 'benutzer.email Desc' : 'benutzer.email' }" />
                                            <f:ajax render="@form" />
                                        </button>
                                    </th>
                                    <!-- INSTITUTION HEADER -->
                                    <th>
                                        <button
                                            class="button-link"
                                            style="width: 100%; text-align: left;"
                                            jsf:action="#{AdministrationForm.administrationPlugin.filterUser}">
                                            <h:outputText value="#{msgs.plugin_administration_deliveryManagement_intitution}" />
                                            <span class="pull-right table-sort-icon fa #{AdministrationForm.administrationPlugin.userSort== 'institution.longName Desc' ?'fa-sort-desc':AdministrationForm.administrationPlugin.userSort== 'institution.longName' ?'fa-sort-asc':'fa-sort'}"></span>
                                            <f:setPropertyActionListener
                                                target="#{AdministrationForm.administrationPlugin.userSort}"
                                                value="#{AdministrationForm.administrationPlugin.userSort== 'institution.longName' ? 'institution.longName Desc' : 'institution.longName' }" />
                                            <f:ajax render="@form" />
                                        </button>
                                    </th>
                                    <!-- LAST CHANGE HEADER -->
                                    <th>
                                        <button
                                            class="button-link"
                                            style="width: 100%; text-align: left;"
                                            jsf:action="#{AdministrationForm.administrationPlugin.filterUser}">
                                            <h:outputText value="#{msgs.plugin_administration_deliveryManagement_lastChangeDate}" />
                                            <span class="pull-right table-sort-icon fa #{AdministrationForm.administrationPlugin.userSort== 'lastDate Desc' ?'fa-sort-desc':AdministrationForm.administrationPlugin.userSort== 'lastDate' ?'fa-sort-asc':'fa-sort'}"></span>
                                            <f:setPropertyActionListener
                                                target="#{AdministrationForm.administrationPlugin.userSort}"
                                                value="#{AdministrationForm.administrationPlugin.userSort== 'lastDate' ? 'lastDate Desc' : 'lastDate' }" />
                                            <f:ajax render="@form" />
                                        </button>
                                    </th>
                                    <!-- NUMBER OF UPLOADS HEADER -->
                                    <th>
                                        <button
                                            class="button-link"
                                            style="width: 100%; text-align: left;"
                                            jsf:action="#{AdministrationForm.administrationPlugin.filterUser}">
                                            <h:outputText value="#{msgs.plugin_administration_deliveryManagement_numberOfUploads}" />
                                            <span class="pull-right table-sort-icon fa #{AdministrationForm.administrationPlugin.userSort== 'items Desc' ?'fa-sort-desc':AdministrationForm.administrationPlugin.userSort== 'items' ?'fa-sort-asc':'fa-sort'}"></span>
                                            <f:setPropertyActionListener
                                                target="#{AdministrationForm.administrationPlugin.userSort}"
                                                value="#{AdministrationForm.administrationPlugin.userSort== 'items' ? 'items Desc' : 'items' }" />
                                            <f:ajax render="@form" />
                                        </button>
                                    </th>
                                    <!-- ACC STATUS HEADER -->
                                    <th>
                                        <button
                                            class="button-link"
                                            style="width: 100%; text-align: left;"
                                            jsf:action="#{AdministrationForm.administrationPlugin.filterUser}">
                                            <h:outputText value="#{msgs.plugin_administration_deliveryManagement_status}" />
                                            <span class="pull-right table-sort-icon fa #{AdministrationForm.administrationPlugin.userSort== 'status Desc' ?'fa-sort-desc':AdministrationForm.administrationPlugin.userSort== 'status' ?'fa-sort-asc':'fa-sort'}"></span>
                                            <f:setPropertyActionListener
                                                target="#{AdministrationForm.administrationPlugin.userSort}"
                                                value="#{AdministrationForm.administrationPlugin.userSort== 'status' ? 'status Desc' : 'status' }" />
                                            <f:ajax render="@form" />
                                        </button>
                                    </th>
                                    <!-- ACTION HEADER -->
                                    <intranda:columnheader
                                        name="actions"
                                        value="#{msgs.auswahl}"
                                        sortable="false" />
                                </tr>
                            </thead>
                            <ui:repeat
                                var="item"
                                value="#{AdministrationForm.administrationPlugin.userPaginator.list}"
                                varStatus="status">
                                <tr role="row">
                                    <!-- NAME DATA -->
                                    <td>
                                        <h:outputText
                                            value="#{item.user.nachname}, #{item.user.vorname}"
                                            styleClass="userID_#{item.user.vorname}_#{item.user.nachname}"
                                            title="#{item.user.login}" />
                                    </td>
                                    <!-- LOGIN DATA -->
                                    <td>
                                        <h:outputText value="#{item.user.login}" />
                                    </td>
                                    <!-- EMAIL DATA -->
                                    <td>
                                        <h:outputText value="#{item.user.email}" />
                                    </td>
                                    <!-- INSTITUTION DATA -->
                                    <td>
                                        <h:outputText value="#{item.institution.longName}" />
                                    </td>
                                    <!-- LAST CHANGE DATA -->
                                    <td>
                                        <h:outputText value="#{item.lastUploadDate == null ? ' - ' : item.lastUploadDate}">
                                            <f:convertDateTime
                                                type="both"
                                                dateStyle="short"
                                                timeStyle="medium" />
                                        </h:outputText>
                                    </td>
                                    <!-- NUMBER OF UPLOADS DATA -->
                                    <td>
                                        <h:outputText value="#{item.numberOfUploads gt 0 ? item.numberOfUploads : '-'}" />
                                    </td>
                                    <!-- ACC STATUS DATA -->
                                    <td>
                                        <h:panelGroup
                                            rendered="#{item.user.status eq 'REGISTERED'}"
                                            class="badge badge-intranda-orange">
                                            <i class="fa fa-key"></i>
                                            #{msgs.plugin_administration_deliveryManagement_displayMode_user_status_registered}
                                        </h:panelGroup>
                                        <h:panelGroup
                                            rendered="#{item.user.status eq 'ACTIVE'}"
                                            class="badge badge-intranda-green">
                                            <i class="fa fa-unlock"></i>
                                            #{msgs.plugin_administration_deliveryManagement_displayMode_user_status_active}
                                        </h:panelGroup>
                                        <h:panelGroup
                                            rendered="#{item.user.status eq 'INACTIVE'}"
                                            class="badge badge-intranda-grey">
                                            <i class="fa fa-lock"></i>
                                            #{msgs.plugin_administration_deliveryManagement_displayMode_user_status_inactive}
                                        </h:panelGroup>
                                        <h:panelGroup
                                            rendered="#{item.user.status eq 'REJECTED'}"
                                            class="badge badge-intranda-red">
                                            <i class="fa fa-lock"></i>
                                            #{msgs.plugin_administration_deliveryManagement_displayMode_user_status_rejected}
                                        </h:panelGroup>
                                        <h:panelGroup
                                            rendered="#{item.user.status eq 'DELETED'}"
                                            class="badge badge-intranda-red">
                                            <i class="fa fa-lock"></i>
                                            #{msgs.plugin_administration_deliveryManagement_displayMode_user_status_deleted}
                                        </h:panelGroup>
                                    </td>
                                    <!-- ACTION DATA -->
                                    <td>
                                        <div class="gw-table__actions__container">
                                            <!-- EDIT -->
                                            <button
                                            jsf:id="edit"
                                            class="btn btn-blank me-2"
                                            jsf:rel="tooltip"
                                            title="#{msgs.benutzerBearbeiten}">
                                            <span class="fa fa-pencil" />
                                            <f:passThroughAttribute
                                                name="data-toggle"
                                                value="tooltip" />
                                            <f:passThroughAttribute
                                                name="aria-label"
                                                value="#{msgs.benutzerBearbeiten}" />
                                            <f:setPropertyActionListener
                                                target="#{AdministrationForm.administrationPlugin.extendedUser}"
                                                value="#{item}" />
                                            <f:setPropertyActionListener
                                                value="edit"
                                                target="#{AdministrationForm.administrationPlugin.editionMode}" />
                                        </button>

                                        <!-- DOWNLOAD INSTITUTION DATA -->
                                        <button
                                            jsf:id="export"
                                            class="btn btn-blank me-2"
                                            jsf:rel="tooltip"
                                            aria-label="#{msgs.plugin_administration_deliveryManagement_downloadInstitutionData}"
                                            title="#{msgs.plugin_administration_deliveryManagement_downloadInstitutionData}"
                                            jsf:action="#{AdministrationForm.administrationPlugin.exportInstitutionCoreData}">
                                            <span class="fa fa-download" />
                                            <f:passThroughAttribute
                                                name="data-toggle"
                                                value="tooltip" />
                                            <f:setPropertyActionListener
                                                target="#{AdministrationForm.administrationPlugin.institution}"
                                                value="#{item.institution}" />
                                        </button>

                                        <!-- DISPLAY IMPORTS -->
                                        <button
                                            jsf:rendered="#{item.numberOfUploads gt 0}"
                                            class="btn btn-blank me-2"
                                            jsf:rel="tooltip"
                                            aria-label="#{msgs.plugin_administration_deliveryManagement_displayImports}"
                                            jsf:title="#{msgs.plugin_administration_deliveryManagement_displayImports}"
                                            jsf:action="#{AdministrationForm.administrationPlugin.generateInstitutionProcessTitleList}">
                                            <span class="fa fa-list" />
                                            <f:passThroughAttribute
                                                name="data-toggle"
                                                value="tooltip" />
                                            <f:setPropertyActionListener
                                                target="#{AdministrationForm.administrationPlugin.institution}"
                                                value="#{item.institution}" />
                                            <f:setPropertyActionListener
                                                value="imports"
                                                target="#{AdministrationForm.administrationPlugin.editionMode}" />
                                            <f:ajax render="@all" />
                                        </button>
                                        </div>
                                    </td>
                                </tr>
                            </ui:repeat>
                        </table>
                    </div>
                    <!-- BUTTON ROW -->
                    <div class="box__actions">

                        <!-- UPLOAD -->
                        <p:fileUpload
                            styleClass="me-auto"
                            listener="#{AdministrationForm.administrationPlugin.handleFileUpload}"
                            id="upload"
                            name="uploadName"
                            auto="true"
                            mode="advanced"
                            multiple="true"
                            dragDropSupport="true"
                            label="#{msgs.plugin_administration_deliveryManagement_uploadInstitutionData}"
                            allowTypes="/(\.|\/)(xml)$/"
                            update="@form :globalMessage">
                            <f:passThroughAttribute
                                name="aria-label"
                                value="#{msgs.plugin_administration_deliveryManagement_uploadFile}" />
                        </p:fileUpload>

                        <!-- PAGINATOR -->
                        <div class="dataTables__paginator">
                            <intranda:tablePaginator
                                id="users"
                                paginator="#{AdministrationForm.administrationPlugin.userPaginator}" />
                        </div>
                    </div>
                </h:form>
            </div>
        </h:form>

        <!-- EDIT FORM -->
        <h:form
            rendered="#{AdministrationForm.administrationPlugin.editionMode=='edit'}">

            <!-- LASTNAME -->
            <div class="row">
                <div class="col-12 col-md-3">
                    <intranda:formLabel
                        label="#{msgs.nachname}"
                        labelFor="lastname"
                        labelRequired="true" />
                </div>
                <div class="col-12 col-md-9">
                    <h:inputText
                        id="lastname"
                        styleClass="form-control form__input"
                        value="#{AdministrationForm.administrationPlugin.user.nachname}"
                        required="true"
                        readonly="false"
                        tabindex="0" />
                    <intranda:formHelp
                        content="#{msgs.helpNachname}" />
                </div>
            </div>

            <!-- FIRST NAME -->
            <intranda:formInputTextAjax
                id="firstname"
                label="#{msgs.vorname}"
                field="#{AdministrationForm.administrationPlugin.user.vorname}"
                help="#{msgs.helpVorname}"
                name="vorname"
                execute="@this"
                />

            <!-- PLACE -->
            <intranda:formInputTextAjax
                id="location"
                label="#{msgs.standort}"
                field="#{AdministrationForm.administrationPlugin.user.standort}"
                help="#{msgs.helpStandort}"
                name="standort"
                execute="@this"
                />
        </h:form>

    </composite:implementation>

</ui:composition>
